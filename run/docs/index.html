
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>

    <script src="javascripts/bsv.browser.min.js"></script>
    <script src="javascripts/run.browser.min.js"></script>
    <script src="javascripts/star.browser.min.js"></script>

    <style>
      .emoji {
        width: 14px
      }
    </style>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
          </li>
          <li>
            <a href="#getting-started" class="toc-h1 toc-link" data-title="Getting Started">Getting Started</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#getting-started-installation" class="toc-h2 toc-link" data-title="Installation">Installation</a>
                  </li>
                  <li>
                    <a href="#getting-started-setup" class="toc-h2 toc-link" data-title="Setup">Setup</a>
                  </li>
                  <li>
                    <a href="#getting-started-creating-jigs" class="toc-h2 toc-link" data-title="Creating Jigs">Creating Jigs</a>
                  </li>
                  <li>
                    <a href="#getting-started-loading-jigs" class="toc-h2 toc-link" data-title="Loading Jigs">Loading Jigs</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#jigs" class="toc-h1 toc-link" data-title="Jigs">Jigs</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#jigs-creating" class="toc-h2 toc-link" data-title="Creating">Creating</a>
                  </li>
                  <li>
                    <a href="#jigs-updating" class="toc-h2 toc-link" data-title="Updating">Updating</a>
                  </li>
                  <li>
                    <a href="#jigs-sending" class="toc-h2 toc-link" data-title="Sending">Sending</a>
                  </li>
                  <li>
                    <a href="#jigs-syncing" class="toc-h2 toc-link" data-title="Syncing">Syncing</a>
                  </li>
                  <li>
                    <a href="#jigs-interactivity" class="toc-h2 toc-link" data-title="Interactivity">Interactivity</a>
                  </li>
                  <li>
                    <a href="#jigs-extending" class="toc-h2 toc-link" data-title="Extending">Extending</a>
                  </li>
                  <li>
                    <a href="#jigs-backing" class="toc-h2 toc-link" data-title="Backing">Backing</a>
                  </li>
                  <li>
                    <a href="#jigs-parameter-validation" class="toc-h2 toc-link" data-title="Parameter Validation">Parameter Validation</a>
                  </li>
                  <li>
                    <a href="#jigs-limiting-supply" class="toc-h2 toc-link" data-title="Limiting Supply">Limiting Supply</a>
                  </li>
                  <li>
                    <a href="#jigs-downloading-classes" class="toc-h2 toc-link" data-title="Downloading Classes">Downloading Classes</a>
                  </li>
                  <li>
                    <a href="#jigs-fungible-tokens" class="toc-h2 toc-link" data-title="Fungible Tokens">Fungible Tokens</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#advanced-usage" class="toc-h1 toc-link" data-title="Advanced Usage">Advanced Usage</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#advanced-usage-debugging-tips" class="toc-h2 toc-link" data-title="Debugging Tips">Debugging Tips</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#advanced-usage-debugging-tips-writing-unit-tests" class="toc-h3 toc-link" data-title="Writing Unit Tests">Writing Unit Tests</a>
                          </li>
                          <li>
                            <a href="#advanced-usage-debugging-tips-too-long-mempool-chain" class="toc-h3 toc-link" data-title="too-long-mempool-chain">too-long-mempool-chain</a>
                          </li>
                          <li>
                            <a href="#advanced-usage-debugging-tips-getting-help" class="toc-h3 toc-link" data-title="Getting Help">Getting Help</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#advanced-usage-private-properties" class="toc-h2 toc-link" data-title="Private Properties">Private Properties</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-class-properties" class="toc-h2 toc-link" data-title="Class Properties">Class Properties</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-checking-the-caller" class="toc-h2 toc-link" data-title="Checking the Caller">Checking the Caller</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-storing-classes" class="toc-h2 toc-link" data-title="Storing Classes">Storing Classes</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-class-presets" class="toc-h2 toc-link" data-title="Class Presets">Class Presets</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-batch-transactions" class="toc-h2 toc-link" data-title="Batch Transactions">Batch Transactions</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-atomic-swaps" class="toc-h2 toc-link" data-title="Atomic Swaps">Atomic Swaps</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-running-arbitrary-code" class="toc-h2 toc-link" data-title="Running Arbitrary Code">Running Arbitrary Code</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-upgrading-jigs" class="toc-h2 toc-link" data-title="Upgrading Jigs">Upgrading Jigs</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#how-it-works" class="toc-h1 toc-link" data-title="How It Works">How It Works</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#how-it-works-overview" class="toc-h2 toc-link" data-title="Overview">Overview</a>
                  </li>
                  <li>
                    <a href="#how-it-works-transaction-format" class="toc-h2 toc-link" data-title="Transaction Format">Transaction Format</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#how-it-works-transaction-format-op_return-protocol" class="toc-h3 toc-link" data-title="op_return protocol">op_return protocol</a>
                          </li>
                          <li>
                            <a href="#how-it-works-transaction-format-json-payload" class="toc-h3 toc-link" data-title="json payload">json payload</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#how-it-works-inputs-and-outputs" class="toc-h2 toc-link" data-title="Inputs and Outputs">Inputs and Outputs</a>
                  </li>
                  <li>
                    <a href="#how-it-works-serialization" class="toc-h2 toc-link" data-title="Serialization">Serialization</a>
                  </li>
                  <li>
                    <a href="#how-it-works-privacy" class="toc-h2 toc-link" data-title="Privacy">Privacy</a>
                  </li>
                  <li>
                    <a href="#how-it-works-security" class="toc-h2 toc-link" data-title="Security">Security</a>
                  </li>
                  <li>
                    <a href="#how-it-works-signing-rules" class="toc-h2 toc-link" data-title="Signing Rules">Signing Rules</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#api-reference" class="toc-h1 toc-link" data-title="API Reference">API Reference</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#api-reference-run" class="toc-h2 toc-link" data-title="Run">Run</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-run-constructor-options" class="toc-h3 toc-link" data-title="constructor(options)">constructor(options)</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-load-location" class="toc-h3 toc-link" data-title="load(location)">load(location)</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-deploy-code" class="toc-h3 toc-link" data-title="deploy(code)">deploy(code)</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-sync" class="toc-h3 toc-link" data-title="sync()">sync()</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-owner" class="toc-h3 toc-link" data-title="owner">owner</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-purse" class="toc-h3 toc-link" data-title="purse">purse</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-transaction" class="toc-h3 toc-link" data-title="transaction">transaction</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-blockchain" class="toc-h3 toc-link" data-title="blockchain">blockchain</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-app" class="toc-h3 toc-link" data-title="app">app</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-activate" class="toc-h3 toc-link" data-title="activate()">activate()</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-instance" class="toc-h3 toc-link" data-title="static instance">static instance</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-version" class="toc-h3 toc-link" data-title="static version">static version</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-jig" class="toc-h3 toc-link" data-title="static Jig">static Jig</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-token" class="toc-h3 toc-link" data-title="static Token">static Token</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-expect" class="toc-h3 toc-link" data-title="static expect">static expect</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-mockchain" class="toc-h3 toc-link" data-title="static Mockchain">static Mockchain</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-statecache" class="toc-h3 toc-link" data-title="static StateCache">static StateCache</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-jig" class="toc-h2 toc-link" data-title="Jig">Jig</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-jig-init" class="toc-h3 toc-link" data-title="init()">init()</a>
                          </li>
                          <li>
                            <a href="#api-reference-jig-sync" class="toc-h3 toc-link" data-title="sync()">sync()</a>
                          </li>
                          <li>
                            <a href="#api-reference-jig-origin" class="toc-h3 toc-link" data-title="origin">origin</a>
                          </li>
                          <li>
                            <a href="#api-reference-jig-location" class="toc-h3 toc-link" data-title="location">location</a>
                          </li>
                          <li>
                            <a href="#api-reference-jig-owner" class="toc-h3 toc-link" data-title="owner">owner</a>
                          </li>
                          <li>
                            <a href="#api-reference-jig-satoshis" class="toc-h3 toc-link" data-title="satoshis">satoshis</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-owner" class="toc-h2 toc-link" data-title="Owner">Owner</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-owner-jigs" class="toc-h3 toc-link" data-title="jigs">jigs</a>
                          </li>
                          <li>
                            <a href="#api-reference-owner-code" class="toc-h3 toc-link" data-title="code">code</a>
                          </li>
                          <li>
                            <a href="#api-reference-owner-privkey" class="toc-h3 toc-link" data-title="privkey">privkey</a>
                          </li>
                          <li>
                            <a href="#api-reference-owner-pubkey" class="toc-h3 toc-link" data-title="pubkey">pubkey</a>
                          </li>
                          <li>
                            <a href="#api-reference-owner-address" class="toc-h3 toc-link" data-title="address">address</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-transaction" class="toc-h2 toc-link" data-title="Transaction">Transaction</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-transaction-begin" class="toc-h3 toc-link" data-title="begin()">begin()</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-end" class="toc-h3 toc-link" data-title="end()">end()</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-export" class="toc-h3 toc-link" data-title="export()">export()</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-import" class="toc-h3 toc-link" data-title="import()">import()</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-rollback" class="toc-h3 toc-link" data-title="rollback()">rollback()</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-pay" class="toc-h3 toc-link" data-title="pay()">pay()</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-sign" class="toc-h3 toc-link" data-title="sign()">sign()</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-actions" class="toc-h3 toc-link" data-title="actions">actions</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-token" class="toc-h2 toc-link" data-title="Token">Token</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-token-constructor-amount" class="toc-h3 toc-link" data-title="constructor(amount)">constructor(amount)</a>
                          </li>
                          <li>
                            <a href="#api-reference-token-send-to-amount" class="toc-h3 toc-link" data-title="send(to, amount)">send(to, amount)</a>
                          </li>
                          <li>
                            <a href="#api-reference-token-amount" class="toc-h3 toc-link" data-title="amount">amount</a>
                          </li>
                          <li>
                            <a href="#api-reference-token-value" class="toc-h3 toc-link" data-title="value">value</a>
                          </li>
                          <li>
                            <a href="#api-reference-token-static-combine-tokens" class="toc-h3 toc-link" data-title="static combine(...tokens)">static combine(...tokens)</a>
                          </li>
                          <li>
                            <a href="#api-reference-token-static-decimals" class="toc-h3 toc-link" data-title="static decimals">static decimals</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-expect" class="toc-h2 toc-link" data-title="expect">expect</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-expect-not" class="toc-h3 toc-link" data-title=".not">.not</a>
                          </li>
                          <li>
                            <a href="#api-reference-expect-tobe" class="toc-h3 toc-link" data-title=".toBe()">.toBe()</a>
                          </li>
                          <li>
                            <a href="#api-reference-expect-toequal" class="toc-h3 toc-link" data-title=".toEqual()">.toEqual()</a>
                          </li>
                          <li>
                            <a href="#api-reference-expect-tobeinstanceof" class="toc-h3 toc-link" data-title=".toBeInstanceOf()">.toBeInstanceOf()</a>
                          </li>
                          <li>
                            <a href="#api-reference-expect-tobedefined" class="toc-h3 toc-link" data-title=".toBeDefined()">.toBeDefined()</a>
                          </li>
                          <li>
                            <a href="#api-reference-expect-tobenull" class="toc-h3 toc-link" data-title=".toBeNull()">.toBeNull()</a>
                          </li>
                          <li>
                            <a href="#api-reference-expect-tobenumber" class="toc-h3 toc-link" data-title=".toBeNumber()">.toBeNumber()</a>
                          </li>
                          <li>
                            <a href="#api-reference-expect-tobeinteger" class="toc-h3 toc-link" data-title=".toBeInteger()">.toBeInteger()</a>
                          </li>
                          <li>
                            <a href="#api-reference-expect-tobelessthan" class="toc-h3 toc-link" data-title=".toBeLessThan()">.toBeLessThan()</a>
                          </li>
                          <li>
                            <a href="#api-reference-expect-tobelessthanorequalto" class="toc-h3 toc-link" data-title=".toBeLessThanOrEqualTo()">.toBeLessThanOrEqualTo()</a>
                          </li>
                          <li>
                            <a href="#api-reference-expect-tobegreaterthan" class="toc-h3 toc-link" data-title=".toBeGreaterThan()">.toBeGreaterThan()</a>
                          </li>
                          <li>
                            <a href="#api-reference-expect-tobegreaterthanorequalto" class="toc-h3 toc-link" data-title=".toBeGreaterThanOrEqualTo()">.toBeGreaterThanOrEqualTo()</a>
                          </li>
                          <li>
                            <a href="#api-reference-expect-tobeboolean" class="toc-h3 toc-link" data-title=".toBeBoolean()">.toBeBoolean()</a>
                          </li>
                          <li>
                            <a href="#api-reference-expect-tobestring" class="toc-h3 toc-link" data-title=".toBeString()">.toBeString()</a>
                          </li>
                          <li>
                            <a href="#api-reference-expect-tobeobject" class="toc-h3 toc-link" data-title=".toBeObject()">.toBeObject()</a>
                          </li>
                          <li>
                            <a href="#api-reference-expect-tobearray" class="toc-h3 toc-link" data-title=".toBeArray()">.toBeArray()</a>
                          </li>
                          <li>
                            <a href="#api-reference-expect-tobeclass" class="toc-h3 toc-link" data-title=".toBeClass()">.toBeClass()</a>
                          </li>
                          <li>
                            <a href="#api-reference-expect-tobefunction" class="toc-h3 toc-link" data-title=".toBeFunction()">.toBeFunction()</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-blockchain" class="toc-h2 toc-link" data-title="Blockchain">Blockchain</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-blockchain-network" class="toc-h3 toc-link" data-title="network">network</a>
                          </li>
                          <li>
                            <a href="#api-reference-blockchain-broadcast-tx" class="toc-h3 toc-link" data-title="broadcast(tx)">broadcast(tx)</a>
                          </li>
                          <li>
                            <a href="#api-reference-blockchain-fetch-txid" class="toc-h3 toc-link" data-title="fetch(txid)">fetch(txid)</a>
                          </li>
                          <li>
                            <a href="#api-reference-blockchain-utxos-address" class="toc-h3 toc-link" data-title="utxos(address)">utxos(address)</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-mockchain" class="toc-h2 toc-link" data-title="Mockchain">Mockchain</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-mockchain-constructor" class="toc-h3 toc-link" data-title="constructor()">constructor()</a>
                          </li>
                          <li>
                            <a href="#api-reference-mockchain-fund-address-satoshis" class="toc-h3 toc-link" data-title="fund(address, satoshis)">fund(address, satoshis)</a>
                          </li>
                          <li>
                            <a href="#api-reference-mockchain-block" class="toc-h3 toc-link" data-title="block()">block()</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-pay" class="toc-h2 toc-link" data-title="Pay">Pay</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-pay-pay" class="toc-h3 toc-link" data-title="pay()">pay()</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-purse" class="toc-h2 toc-link" data-title="Purse">Purse</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-purse-privkey" class="toc-h3 toc-link" data-title="privkey">privkey</a>
                          </li>
                          <li>
                            <a href="#api-reference-purse-address" class="toc-h3 toc-link" data-title="address">address</a>
                          </li>
                          <li>
                            <a href="#api-reference-purse-splits" class="toc-h3 toc-link" data-title="splits">splits</a>
                          </li>
                          <li>
                            <a href="#api-reference-purse-balance" class="toc-h3 toc-link" data-title="balance()">balance()</a>
                          </li>
                          <li>
                            <a href="#api-reference-purse-utxos" class="toc-h3 toc-link" data-title="utxos()">utxos()</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-state" class="toc-h2 toc-link" data-title="State">State</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-state-get-location" class="toc-h3 toc-link" data-title="get(location)">get(location)</a>
                          </li>
                          <li>
                            <a href="#api-reference-state-set-location-state" class="toc-h3 toc-link" data-title="set(location, state)">set(location, state)</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-statecache" class="toc-h2 toc-link" data-title="StateCache">StateCache</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-statecache-constructor-options" class="toc-h3 toc-link" data-title="constructor(options)">constructor(options)</a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
      </ul>
        <ul class="toc-footer">
            <li>version 0.4.1</li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>Run is a platform to build apps and tokens on Bitcoin. Run supports full object-oriented programming and arbitrary code using JavaScript, and it is secure and performant for real applications today. This software development kit (SDK) will help you interact with the Run protocol, useful services, and Bitcoin.</p>

<p>Developers write applications using interactive objects, called jigs. Jigs allow you to build almost anything you can dream up: tokens, contracts, interfaces, elections, games, digital pets, and more — all run on Bitcoin.</p>
<h1 id='getting-started'>Getting Started</h1><h2 id='getting-started-installation'>Installation</h2>
<blockquote>
<p>Load both <code>bsv</code> and Run in the browser</p>
</blockquote>
<pre class="highlight html tab-html"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"bsv.browser.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"run.browser.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre>
<blockquote>
<p>Load Run in Node.js</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">Run</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./dist/run.node.min'</span><span class="p">)</span>
</code></pre>
<p>If you&#39;re new to Run, let the <a href="https://run.network">tutorial series</a> guide your journey to get acquainted. You can write code without installing anything. The web browser Console will be your playground.</p>

<p>The details written here in the Docs have example code in the sidebar on the right-hand side. Anything you read in paragraphs, you can preview in-action over there. ⇥</p>

<p>Run works everywhere including all major browsers, on desktop and mobile, as well as Node.js on servers. Run is written in JavaScript ES6 and uses the <a href="https://github.com/moneybutton/bsv"><strong>bsv</strong> library</a> to build and sign transactions. To get started:</p>

<ul>
<li>For a webpage: Add <code>bsv.browser.min.js</code> and <code>run.browser.min.js</code> to the <code>&lt;head&gt;</code> tag.</li>
<li>For Node.js: Execute <code>npm install bsv</code> to install <strong>bsv</strong>, then import <code>run.node.min.js</code>.</li>
</ul>

<p>And that&#39;s it. All your code and jigs will be saved on-chain and Run will use public APIs to interact with the Bitcoin network. You don&#39;t need to deploy any servers with Run. All the logic works client-side.</p>
<h2 id='getting-started-setup'>Setup</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">network</span><span class="p">:</span> <span class="s1">'mock'</span> <span class="p">})</span>
</code></pre>
<p>The Run instance manages your communication with the Bitcoin network. The default network is <code>main</code> (Mainnet), but for development and testing, we recommend <code>mock</code>. Mock is an in-memory simulation blockchain that does not require funds to use. We like to call it the <em>mockchain</em>. For more configuration options, see <a href="#api-reference-run">API Reference: Run</a>.</p>
<h2 id='getting-started-creating-jigs'>Creating Jigs</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">SimpleStore</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">set</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">jig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleStore</span><span class="p">()</span>

<span class="nx">jig</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'Satoshi Nakamoto'</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">jig</span><span class="p">.</span><span class="nx">owner</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">jig</span><span class="p">.</span><span class="nx">location</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">jig</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
</code></pre>
<p>Let&#39;s begin with a basic jig that stores a value in a variable. Create a jig called <code>SimpleStore</code>. By extending from <code>Jig</code>, the instances of your class will automatically sync to the blockchain. Every jig has an <code>owner</code>. Any code may read jigs but only its <code>owner</code> can update it. The <code>owner</code> is a Bitcoin public key, and the private key is required to update it.</p>

<p>In addition to <code>owner</code>, every jig has a <code>location</code>. A jig&#39;s <code>location</code> is the pairing of a Bitcoin transaction ID and an output index, and it represents a particular state in time of an object or class on Bitcoin. When you check the <code>location</code> property of a jig, you get its current location. If you wish to get the location where the jig was first deployed, that is called its <code>origin</code>. The <code>origin</code> is unique and will not change, however <code>location</code> changes with every update. After a method call, your jig will have a new <code>location</code> pointing to a Bitcoin transaction containing the last method call.</p>
<h2 id='getting-started-loading-jigs'>Loading Jigs</h2>
<blockquote>
<p>Loading all jigs</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">simpleStore</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">owner</span><span class="p">.</span><span class="nx">jigs</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="k">instanceof</span> <span class="nx">SimpleStore</span><span class="p">)</span>

<span class="nx">simpleStore</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>Loading a specific jig</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">specificJig</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">simpleStore</span><span class="p">.</span><span class="nx">location</span><span class="p">)</span>

<span class="nx">specificJig</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'abc'</span><span class="p">)</span>
</code></pre>
<p>The simplest way to load your jigs is to call <code>run.sync()</code> and then access <code>run.owner.jigs</code>. <code>run.sync()</code> will find and load all objects owned by <code>run.owner</code> and place them in the <code>jigs</code> array. Once loaded, you may call methods and use them normally. Alternatively, you may wish to load a particular jig or load a jig from a historical location or previous state. To do either, pass the <code>location</code> of the jig you wish to load into <code>run.load()</code>.</p>

<p>If you&#39;ve loaded a historical location so that your jig is in a previous state, you&#39;ll need to first catch up to the latest state before you&#39;ll be allowed to make a method call. <code>sync()</code> will handily fast-forward a jig to its latest state on the blockchain <em>without</em> triggering a Bitcoin transaction. In the example on the sidebar, if <code>specificJig</code> was in a historical state, you would call <code>specificJig.sync()</code> and then call <code>specificJig.set(&#39;abc&#39;)</code>. When you accidentally try to update a jig without the jig being in its latest state, Run will safely abort before publishing a Bitcoin transaction and inform you with an error. In that case, you&#39;ll just need to add the preceding <code>sync()</code> call and execute your code again. The best practice is to write code in such a way that jigs are always up-to-date in their latest state. Run manages the heavy lifting for you.</p>

<p><code>sync()</code> also acts as a debugging tool since it surfaces any errors your jigs have. If you notice your app acting funny, a well-placed preceding <code>specificJig.sync()</code> can help you uncover the error. You may also call <code>sync()</code> on the Run instance, like this: <code>run.sync()</code>. That&#39;ll help you search out any errors from your entire app in <em>all</em> of the jigs you own.</p>
<h1 id='jigs'>Jigs</h1>
<p>Jigs are interactive objects on Bitcoin. You define a jig with a JavaScript class and that class determines exactly what the jig can do. Every instance of a jig is unique. Each one has an owner and only that owner can update the jig. How is that secured? Bitcoin! Let&#39;s explore how you create a jig.</p>
<h2 id='jigs-creating'>Creating</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Post</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> 
    <span class="nx">init</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">new</span> <span class="nx">Post</span><span class="p">(</span><span class="s1">'Hello, world'</span><span class="p">)</span>
</code></pre>
<p>Let&#39;s create a new jig called <code>Post</code> that represents content on a message board. In JavaScript, your constructor is called <code>constructor</code> but for jigs, this method is called <code>init</code>. Think of them the same way. If <code>init</code> throws an exception, the jig will never be created, just like constructors. You create jigs by calling <code>new</code> as you would with normal JavaScript objects and they get deployed onto the Bitcoin network. Pretty cool.</p>
<h2 id='jigs-updating'>Updating</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">EditablePost</span> <span class="kr">extends</span> <span class="nx">Post</span> <span class="p">{</span>
    <span class="nx">edit</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">editablePost</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EditablePost</span><span class="p">(</span><span class="s1">'Hello, world'</span><span class="p">)</span>

<span class="nx">editablePost</span><span class="p">.</span><span class="nx">edit</span><span class="p">(</span><span class="s1">'Hello, BitCoin'</span><span class="p">)</span>
</code></pre>
<p>Jigs are updated by calling methods. In fact, that is the only way to update jigs, because if users could assign properties directly, then classes would become irrelevant. When you call a method, Run publishes a Bitcoin transaction with data in an <code>op_return</code> that includes the method name and its arguments. The state may be recomputed simply by playing back every update one-by-one. For more information about how it works, see <a href="#how-it-works">How It Works</a>.</p>
<h2 id='jigs-sending'>Sending</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Dragon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">send</span><span class="p">(</span><span class="nx">pubkey</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">owner</span> <span class="o">=</span> <span class="nx">pubkey</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">new</span> <span class="nx">Dragon</span><span class="p">().</span><span class="nx">send</span><span class="p">(</span><span class="s1">'&lt;some other public key&gt;'</span><span class="p">)</span>
</code></pre>
<p>Jigs may be sent to someone else by changing the <code>owner</code> property of a jig. Simply set the owner to the new owner&#39;s public key. Only public keys are supported and they must be in a string format. After changing the owner, the new owner will be able to update the jig.</p>
<h2 id='jigs-syncing'>Syncing</h2>
<blockquote>
<p>Wait for updates to complete</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">LoyaltyCard</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
    <span class="nx">init</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">stamps</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">}</span>
    <span class="nx">stamp</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">stamps</span> <span class="o">+=</span><span class="mi">1</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">card</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">LoyaltyCard</span><span class="p">()</span>
<span class="nx">await</span> <span class="nx">card</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="nx">card</span><span class="p">.</span><span class="nx">stamp</span><span class="p">()</span>
<span class="nx">await</span> <span class="nx">card</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>
</code></pre>
<blockquote>
<p>Sync a jig from its origin to its latest state</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">card2</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">card</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
<span class="nx">card2</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>
</code></pre>
<p>Run is asynchronous. When you create or update jigs, Run creates Bitcoin transactions for you in the background and broadcasts them to the network. As with any network request, the request may sometimes fail. Your connection may go down or a node on the network may reject your transaction for various reasons. Also, your jigs may be behind the latest state on the network. </p>

<p>Run updates your jig&#39;s state with each method call you make. However, it does <em>not</em> continuously update your jigs. Because if it did, as a developer you&#39;d feel like you were on shifting sand. Instead, you&#39;ve got a reliable and steady state for each jig that you&#39;re working with. </p>

<p>While only the <code>owner</code> can update a jig, depending on the app you&#39;ve built and actions of the owner of the jig, you might need to catch up a jig to its latest state because it could have been modified outside of your app.</p>

<p>Every jig has <code>sync()</code> available to ensure your local state is the same as that on the network. Calling <code>jig.sync()</code> returns a promise that resolves after:</p>

<ol>
<li>All pending local transactions have been published successfully, and </li>
<li>The jig has been caught up with any new transactions from the network.</li>
</ol>

<p>Any errors in validation or network requests will cause the promise to be rejected. </p>

<p>For a development prototype or hackathon project, you won&#39;t need to call <code>sync()</code> very much. Run will happily execute method calls on jigs in their latest state. Unless you notice a problem, you don&#39;t need to worry about <code>sync()</code>. However, in a production app, the best practice is to call <code>sync()</code> after every method call to ensure that you catch errors early and handle them gracefully. Calling <code>sync()</code> will force any error to show up at that particular line in the code.</p>
<h2 id='jigs-interactivity'>Interactivity</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Event</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">createTicket</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">Ticket</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Ticket</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="nx">event</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Event</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">Ticket</span> <span class="p">}</span>
</code></pre>
<p>Jigs may create other jigs. Calling <code>new</code> to construct a jig within another jig&#39;s methods run will create a new output in the transaction. Sometimes you will create new jigs that are of the same class, but many times you will want to create jigs that are of a different class. Because by default Jig code runs in a sandbox without access to other code, you use the <code>Jig.deps</code> property to specify class dependencies.</p>

<p>Jigs may store other jigs as properties too. Think of these as standard JavaScript object references that you may read or write. However, if stored jigs are updated, then their owners must also sign the Bitcoin transaction that updates their state. For more information on spending rules, see the section titled <a href="#how-it-works">How It Works</a>.</p>
<h2 id='jigs-extending'>Extending</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">EditablePost</span> <span class="kr">extends</span> <span class="nx">Post</span> <span class="p">{</span>
  <span class="nx">edit</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Jig classes may be extended from other jig classes to add or alter behavior. This is a great way to build off of established jigs and even support modding communities. Class <code>super</code> calls work as expected, and there is no need to specify parents as dependencies because Run  will automatically detect them.</p>
<h2 id='jigs-backing'>Backing</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Tip</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">pubkey</span><span class="p">,</span> <span class="nx">amount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">owner</span> <span class="o">=</span> <span class="nx">pubkey</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">satoshis</span> <span class="o">=</span> <span class="nx">amount</span>
  <span class="p">}</span>

  <span class="nx">withdraw</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">satoshis</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">new</span> <span class="nx">Tip</span><span class="p">(</span><span class="s1">'I like your videos'</span><span class="p">,</span> <span class="nx">pubkey</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span>
</code></pre>
<p>Jigs may be backed by Bitcoins. When a jig is backed, it means that the output associated with that jig has a non-dust value in it. Backed jigs let users send money between each other and provide a baseline value for items. To back a jig, set the <code>satoshis</code> property to any non-negative number. Your purse will automatically deposit that amount into the jig. When the <code>satoshis</code> property is later decreased, those Bitcoins will be withdrawn to the jig owner&#39;s purse.</p>

<p>It is important to remember that these are <em>backed</em> jigs and not smart contracts. The jig&#39;s owner may always melt the satoshis out of the jig and in doing so destroy the jig.</p>

<aside class="notice">
<b>Note:</b> All bitcoin outputs must have an amount at least the dust limit, currently 546 satoshis, to be accepted by the network. Run will choose the greater of the `satoshis` property and this dust limit when building outputs.
</aside>
<h2 id='jigs-parameter-validation'>Parameter Validation</h2>
<blockquote>
<p>Attaching an item</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Hat</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> <span class="p">}</span>

<span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">wear</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">item</span><span class="p">).</span><span class="nx">toBeInstanceOf</span><span class="p">(</span><span class="nx">Hat</span><span class="p">)</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">item</span> <span class="o">=</span> <span class="nx">item</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Person</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">Hat</span><span class="p">,</span> <span class="na">expect</span><span class="p">:</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">expect</span> <span class="p">}</span>
</code></pre>
<p>Because JavaScript is dynamically typed, Jigs should always validate their parameters. Of course you could write checks and throw Errors yourself, but to make life easy, Run provides the <code>expect</code> helper function. <code>expect</code> is like the assertions you might use in a Jest or Chai unit testing. It lets you to check if a jig is a certain class, if a number is greater than another number, and many other conditions. To get started, add <code>expect</code> as a dependency to your jig as seen to the right. Then, check out the full <a href="#api-reference-expect">expect</a> documention to see what else you can do.</p>

<p>Sometimes you may wish to check if a class is part of a changing set. For example, a game may have a list of item classes that may change over time. For that, see the <a href="#storing-classes">Storing Classes</a> section.</p>

<aside class="warning">
<b>Warning:</b> Using `instanceof` today is not safe because anyone may extend a class and change its behavior. However, in the future, only class authors will be able to extend classes, so you may plan for this today.
</aside>
<h2 id='jigs-limiting-supply'>Limiting Supply</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Weapon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">owner</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">caller</span><span class="p">).</span><span class="nx">toBeInstanceOf</span><span class="p">(</span><span class="nx">GameItems</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">owner</span> <span class="o">=</span> <span class="nx">owner</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">GameItems</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">owner</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">GameItems</span><span class="p">.</span><span class="nx">owner</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">weaponCount</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="p">}</span>

  <span class="nx">createWeapon</span><span class="p">(</span><span class="nx">owner</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="k">this</span><span class="p">.</span><span class="nx">weaponCount</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'too many weapons'</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Weapon</span><span class="p">(</span><span class="nx">owner</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">GameItems</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">Weapon</span><span class="p">,</span> <span class="nx">expect</span> <span class="p">}</span>
<span class="nx">Weapon</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">GameItems</span><span class="p">,</span> <span class="nx">expect</span> <span class="p">}</span>
</code></pre>
<p>The supply of a jig class may be limited through the use of a <em>minter</em>. The <em>minter</em> is a separate jig that regulates the number of <em>mintee</em> jigs produced. In the example on the right, the <code>GameItems</code> jig is the <em>minter</em> and is owned by the game. The <code>Weapon</code> jig is the <em>mintee</em> and is owned by a player. The <code>Weapon</code> class enforces that it can only be created by <code>GameItems</code>, and the <code>GameItems</code> class limits the supply of <code>Weapon</code>.</p>

<p>In <code>Weapon.init</code>, we check that the weapon is being created by a <code>GameItems</code> instance using the <code>caller</code> special property. <code>caller</code> is the jig that called the current method being executed. If a player tried to create a <code>Weapon</code> instance independent of <code>GameItems</code>, Run would throw an error because the <code>caller</code> property would be <code>null</code>.</p>

<p>In <code>GameItems</code>, we check that there are no more than 10 items created by the game in <code>createWeapon(owner)</code>. This limits the supply. However, we also have to check that <code>GameItems</code> is only able to be created by the game company in <code>init()</code>. This is to prevent users from creating their own <code>GameItems</code> classes to mint their own weapons.</p>
<h2 id='jigs-downloading-classes'>Downloading Classes</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Data</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Data</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>

<span class="c1">// The location of the Data class is stored in Data.location</span>
</code></pre>
<blockquote>
<p>Load the Data class from another instance</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">Data</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">'&lt;class-location-goes-here&gt;'</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Data</span><span class="p">(</span><span class="s1">'abc'</span><span class="p">)</span>
</code></pre>
<p>You may wish to download existing code that has already been deployed, for example, to create more instances of a particular class. The <code>run.load</code> method, in addition to loading jigs, is also able to download, install and sandbox code from the blockchain.</p>
<h2 id='jigs-fungible-tokens'>Fungible Tokens</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">USDCoin</span> <span class="kr">extends</span> <span class="nx">Token</span> <span class="p">{</span> <span class="p">}</span>
<span class="nx">USDCoin</span><span class="p">.</span><span class="nx">backingBank</span> <span class="o">=</span> <span class="s1">'HSBC'</span>
<span class="nx">USDCoin</span><span class="p">.</span><span class="nx">bankAccount</span> <span class="o">=</span> <span class="s1">'12345'</span>

<span class="c1">// Mint a new coin. Only USDCoin.owner may do this</span>
<span class="kr">const</span> <span class="nx">mintedCoin</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">USDCoin</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">mintedCoin</span><span class="p">.</span><span class="nx">amount</span><span class="p">)</span> <span class="c1">// 100</span>

<span class="c1">// Send part of a coin to someone else and keep the change</span>
<span class="kr">const</span> <span class="nx">changeCoin</span> <span class="o">=</span> <span class="nx">coinToSend</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">pubkey</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="c1">// Combine two tokens together</span>
<span class="kr">const</span> <span class="nx">combinedCoin</span> <span class="o">=</span> <span class="nx">USDCoin</span><span class="p">.</span><span class="nx">combine</span><span class="p">(</span><span class="nx">coin1</span><span class="p">,</span> <span class="nx">coin2</span><span class="p">)</span>
</code></pre>
<p>It is possible to create fungible tokens similar to ERC-20 with Run. Run provides a base <code>Token</code> class for this purpose. However unlike ERC-20 where multiple users interact through a single contract, in Run each user owns their own tokens. It is closer to Bitcoin UTXOs or SLP tokens. To create a new kind of token, simply extend the <code>Token</code> class with the name of your token. Then you can mint new tokens just by creating new instances. Only you will be able to mint new tokens, but coins you mint may be sent to others.</p>

<p>See <a href="#api-reference-token"><code>API Reference: Token</code></a> for more details.</p>
<h1 id='advanced-usage'>Advanced Usage</h1><h2 id='advanced-usage-debugging-tips'>Debugging Tips</h2>
<p>Sometimes you will be faced with errors you don&#39;t understand. Don&#39;t fret! Here are some tips:</p>

<ul>
<li>Grab the latest Run SDK from <a href="https://www.runonbitcoin.com">runonbitcoin.com</a></li>
<li>Redeploy any jigs from older versions of Run</li>
<li>Use Node 8+ or a modern web browser like Chrome, Firefox, Edge, or Safari</li>
<li>Use the mockchain to check that it is not a connection or server-side error</li>
<li>Enable Run&#39;s internal logs by passing <code>{ logger: console }</code> into <code>Run</code></li>
<li>Disable Run&#39;s sandboxing by passing <code>{ sandbox: false }</code> into <code>Run</code> (Note: This is not recommended in production)</li>
</ul>
<h3 id='advanced-usage-debugging-tips-writing-unit-tests'>Writing Unit Tests</h3>
<p>It is always a good idea to write unit tests for your jigs. We recommend using a framework like <code>mocha</code> or <code>jest</code>, and running your tests using the mockchain. The mockchain will be faster and will isolate your Jig logic from any network errors.</p>
<h3 id='advanced-usage-debugging-tips-too-long-mempool-chain'>too-long-mempool-chain</h3>
<p>If you see a <code>too-long-mempool-chain</code> error, it means that you&#39;ve hit a BSV network limitation. Today, only 25 transactions may be chained together in each Bitcoin block, and because of how Run works, you are likely to hit this in one of two ways:</p>

<ol>
<li>You update a jig 25 times in a ~10 minute block window</li>
<li>You create ~250 separate jigs in a ~10 minute block window using the same purse</li>
</ol>

<p>For #1, our best advice is to see if you can rearchitect your Jigs to avoid this case. We will provide a built-in solution in the future to avoid this limit.</p>

<p>For #2, we recommend switching between purses. Run automatically splits your UTXOs into 10 pieces, so you usually will be able to make over 200 transactions per block for each purse. You can increase this limit by setting <code>run.purse.splits = 100</code>.</p>
<h3 id='advanced-usage-debugging-tips-getting-help'>Getting Help</h3>
<p>Please reach out to @niv in the BSV slack channels. We are happy to help you debug and fix any issues you encounter. If you can, see if you can reproduce the issue in the browser using <code>getting_started.html</code>.</p>
<h2 id='advanced-usage-private-properties'>Private Properties</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Dragon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_numberOfCrashLandings</span> <span class="o">=</span> <span class="mi">88</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">InsurancePolicy</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">dragon</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Throws an error !</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">dragon</span><span class="p">.</span><span class="nx">_numberOfCrashLandings</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">chargeMoreMoney</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Jigs may contain private variables and private methods. Private properties are available only within the Jig itself, and by using them, you may precisely control the interface that users and other jigs interact with. Simply prefix your properties with an understore. Run enforces it as a validation rule for Jigs.</p>

<p>There are a few rules to learn. Private variables may only be read inside a jig from one of its methods. If another kind of class attempts to read a private variable, Run will throw an error. Private variables may however be read externally in non-jig code, for example in the web Console. You can use that ability to help you debug and check the values of private properties while you&#39;re developing your app.</p>

<p>Private methods are similar. They may only be called as helper methods from within the same jig or by another jig of the same class. However, unlike private variables, you cannot call a private method externally in the web Console. If you think about, that makes sense, because calling a private method externally would execute code with unintended consequences. Run keeps you safe.</p>

<aside class="warning">
<b>Warning:</b> Private properties are not encrypted. They are an <em>access control</em> feature, not a user privacy feature.
</aside>
<h2 id='advanced-usage-class-properties'>Class Properties</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">DigitalPet</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> <span class="p">}</span>

<span class="nx">DigitalPet</span><span class="p">.</span><span class="nx">author</span> <span class="o">=</span> <span class="s1">'Maximus'</span>
<span class="nx">DigitalPet</span><span class="p">.</span><span class="nx">license</span> <span class="o">=</span> <span class="s1">'MIT'</span>
<span class="nx">DigitalPet</span><span class="p">.</span><span class="nx">icon</span> <span class="o">=</span> <span class="p">{</span> <span class="na">emoji</span><span class="p">:</span> <span class="s1">'🐉'</span> <span class="p">}</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">DigitalPet</span><span class="p">)</span>
</code></pre>
<p>Classes and functions may have static properties as metadata. These properties are stored on-chain with the code definition itself when the code is uploaded. Any later downloads of that code will have these properties set. Class property values may be any type that Run can serialize, including basic data types, jigs, and other classes or functions. Here are some recommended conventions:</p>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>author</code></td>
<td>string</td>
<td>Name of the class&#39;s creator</td>
</tr>
<tr>
<td><code>license</code></td>
<td>string</td>
<td>License for the code</td>
</tr>
<tr>
<td><code>icon</code></td>
<td>object { emoji: string }</td>
<td>Icon to identify the class in block explorers. The <code>emoji</code> property should be a single emoji character.</td>
</tr>
<tr>
<td><code>deps</code></td>
<td>object</td>
<td>Dependencies that are loaded as globals into the code sandbox.</td>
</tr>
</tbody></table>

<p>When code is deployed, Run will set the <code>origin</code>, <code>location</code>, and <code>owner</code> properties on the class.</p>
<h2 id='advanced-usage-checking-the-caller'>Checking the Caller</h2>
<blockquote>
<p>Storing the parent jig</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Child</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">caller</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Enforcing a method may only be called by certain classes</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Database</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">rootUser</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">rootUser</span> <span class="o">=</span> <span class="nx">rootUser</span>
  <span class="p">}</span>

  <span class="nx">deleteAll</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">caller</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">rootUser</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'only the root user may delete the database'</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">deleteDatabase</span><span class="p">(</span><span class="nx">database</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">database</span><span class="p">.</span><span class="nx">deleteAll</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Within Jig code, there is a special <code>caller</code> property that is available. This property is the jig that called this jig&#39;s methods and <code>null</code> if the jig&#39;s method was invoked from application code.</p>

<p>You can use <code>caller</code> to keep track of where a jig came from by storing the parent jig inside of a child jig. You can also enforce that a child jig is created by a specific parent, or enforce that certain methods can only be called by certain jigs.</p>
<h2 id='advanced-usage-storing-classes'>Storing Classes</h2>
<blockquote>
<p>Comparing a class against a dynamic set</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">allowed</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">}</span>

  <span class="nx">allow</span><span class="p">(</span><span class="nx">ItemClass</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">allowed</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">ItemClass</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">wear</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">allowed</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">constructor</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">item</span> <span class="o">=</span> <span class="nx">item</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Jigs may store other classes and functions as properties inside themselves and also accept code as arguments to their methods. This is useful, for example, to define an official list of supported classes used in a game. It may also be used to create dynamic jig factories, and even to upgrade the behavior of a class after it is written. When code is passed or stored for the first time, it will be automatically deployed and assigned an <code>owner</code>. Code is always owned by someone.</p>
<h2 id='advanced-usage-class-presets'>Class Presets</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Dragon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">set</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// In Node.js or the browser, upload the class via `run.deploy` and write down its origin.</span>
<span class="c1">// Then save it onto the class for the appropriate Bitcoin network before distributing.</span>

<span class="nx">Dragon</span><span class="p">.</span><span class="nx">originMainnet</span> <span class="o">=</span> <span class="s1">'bee45c75c37a289517f33ebfa051601c9610ccc56fbddfbabc44413db5b0bc1b_o1'</span>
</code></pre>
<p>In addition to downloading code from the blockchain, Jig classes may be shared with others in libraries. To share a Jig class, first, upload its code manually to each Bitcoin network you wish to support. Then set the following static properties on the class itself before distributing it. Run will automatically use the origins and locations on the appropriate network and not re-deploy the class.</p>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>originMainnet</code></td>
<td>string</td>
<td>Mainnet origin for the uploaded class</td>
</tr>
<tr>
<td><code>originTestnet</code></td>
<td>string</td>
<td>Testnet origin for the uploaded class</td>
</tr>
<tr>
<td><code>originStn</code></td>
<td>string</td>
<td>STN origin for the uploaded class</td>
</tr>
<tr>
<td><code>originMocknet</code></td>
<td>string</td>
<td>Mocknet origin for the uploaded class</td>
</tr>
<tr>
<td><code>locationMainnet</code></td>
<td>string</td>
<td>Mainnet location for the uploaded class</td>
</tr>
<tr>
<td><code>locationTestnet</code></td>
<td>string</td>
<td>Testnet location for the uploaded class</td>
</tr>
<tr>
<td><code>locationStn</code></td>
<td>string</td>
<td>STN location for the uploaded class</td>
</tr>
<tr>
<td><code>locationMocknet</code></td>
<td>string</td>
<td>Mocknet location for the uploaded class</td>
</tr>
<tr>
<td><code>ownerMainnet</code></td>
<td>?string</td>
<td>Optional mainnet owner pubkey for the uploaded class</td>
</tr>
<tr>
<td><code>ownerTestnet</code></td>
<td>?string</td>
<td>Optional testnet owner pubkey for the uploaded class</td>
</tr>
<tr>
<td><code>ownerStn</code></td>
<td>?string</td>
<td>Optional STN owner pubkey for the uploaded class</td>
</tr>
<tr>
<td><code>ownerMocknet</code></td>
<td>?string</td>
<td>Optional mocknet owner pubkey for the uploaded class</td>
</tr>
</tbody></table>

<aside class="warning">
<b>Warning:</b> Run assumes that the class code matches the code that is stored on the blockchain. Only use class libraries from people you trust.
</aside>
<h2 id='advanced-usage-batch-transactions'>Batch Transactions</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">begin</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">jig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CustomJig</span><span class="p">()</span>
<span class="nx">jig</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">to</span><span class="p">)</span>
<span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
</code></pre>
<p>Multiple actions may be batched together into a single atomic Bitcoin transaction. In addition to making these actions all-or-nothing, it also reduces the fees. Any number of updates may be batched together from different jigs. Call <code>run.transaction.begin()</code> before performing updates and <code>run.transaction.end()</code> after. These may also be nested, and when the final <code>end()</code> is called, the transaction will be published on-chain.</p>
<h2 id='advanced-usage-atomic-swaps'>Atomic Swaps</h2>
<blockquote>
<p>Atomically swapping two items with different owners</p>

<p>Machine 1</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">myWeapon</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">weaponLocation</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">theirArmor</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">armorLocation</span><span class="p">)</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">begin</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">me</span> <span class="o">=</span> <span class="nx">myWeapon</span><span class="p">.</span><span class="nx">owner</span>
<span class="nx">myWeapon</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">theirArmor</span><span class="p">.</span><span class="nx">owner</span><span class="p">)</span>
<span class="nx">theirArmor</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">me</span><span class="p">)</span>

<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">pay</span><span class="p">()</span>
<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">sign</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="kr">export</span><span class="p">()</span>
</code></pre>
<blockquote>
<p>Machine 2</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="kr">import</span><span class="p">(</span><span class="nx">tx</span><span class="p">)</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// TODO: Inspect the transaction to be sure it atomically swaps</span>
<span class="p">}</span>
<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">sign</span><span class="p">()</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
</code></pre>
<p>Run supports atomically updating jigs with different owners using the Transaction API. One application for this is atomic swaps, where two jigs owned by different users are exchanged in a single transaction.</p>

<p>The general process for an atomic swap is first for one user to start a Run transaction by calling <code>run.transaction.begin()</code>. Then, this user performs all updates, including calling methods on jigs they don&#39;t own. Run allows this user to build the transaction although they won&#39;t be able to add all of the signatures. Finally, this first user pays for the transaction and sign their jigs. The transaction is complete, and must now be handed to other parties for them to add their signatures. To do that, the first user calls <code>run.transaction.export()</code> to get the bsv transaction and sends it to the other parties via a separate channel.</p>

<p>The other party then calls <code>run.transaction.import()</code> to load the transaction they received. They may then want to check what the transaction does by inspecting <code>run.transaction.actions</code>. If they approve, then they may call <code>run.transaction.sign()</code> to add signatuers for their jigs. This process may continue for additional parties. When all signatures are collected, the last user calls <code>run.transaction.end()</code> to broadcast the transaction to the Bitcoin network.</p>

<p>The Transaction API may also be used to simulate state channels and propose changes to other jigs. See the <a href="#api-reference-transaction">Transaction API</a> for more information.</p>
<h2 id='advanced-usage-running-arbitrary-code'>Running Arbitrary Code</h2>
<blockquote>
<p>Loading a helper class</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Preconditions</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">checkArgument</span><span class="p">(</span><span class="nx">check</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">check</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">()</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">PositiveNumber</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">checkArgument</span><span class="p">(</span><span class="nx">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">PositiveNumber</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="na">$</span><span class="p">:</span> <span class="nx">Preconditions</span> <span class="p">}</span>
</code></pre>
<p>Run supports running arbitrary code from the blockchain and not just jigs. Currently, arbitrary code must be uploaded as either classes or functions. Like jigs, arbitrary code also runs in a sandbox environment but it does not sync with the blockchain. Therefore, it should not save state. One popular use of arbitrary code is to write helper libraries for jigs like big integer math or cryptographic hashing. Another use case is to upgrade behavior of Jig classes. See <a href="#upgrading-jigs">Upgrading Jigs</a> for more details.</p>

<aside class="notice">
<b>Note:</b> Unlike Jigs, arguments that are passed into arbitrary code functions may expose your global scope. Be careful.
</aside>
<h2 id='advanced-usage-upgrading-jigs'>Upgrading Jigs</h2>
<blockquote>
<p>Method 1: Reissuing Jigs</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">OriginalJig</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">f</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">3</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">UpgradedJig</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> 
  <span class="nx">init</span><span class="p">(</span><span class="nx">original</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">original</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">!==</span> <span class="nx">OriginalJig</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'unexpected jig'</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">original</span> <span class="o">=</span> <span class="nx">original</span>
  <span class="p">}</span>
  <span class="nx">f</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">4</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Method 2: Replacing Behavior</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Weapon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">setAttackBehavior</span><span class="p">(</span><span class="nx">attackFunction</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">attackFunction</span> <span class="o">=</span> <span class="nx">attackFunction</span>
  <span class="p">}</span>

  <span class="nx">attack</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">attackFunction</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">weapon</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Weapon</span><span class="p">()</span>

<span class="kd">function</span> <span class="nx">attackPlayer</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">player</span><span class="p">.</span><span class="nx">doDamage</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">weapon</span><span class="p">.</span><span class="nx">setAttackBehavior</span><span class="p">(</span><span class="nx">attackPlayer</span><span class="p">)</span>
<span class="nx">weapon</span><span class="p">.</span><span class="nx">attack</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>
</code></pre>
<p>By default, jig classes are not upgradable. However, you may simulate upgradability by creating a new jig that wraps the old one and adds the new behavior. You may also simulate upgradability by storing behavior in classes. These are both demonstrated on the right. There will be additional ways to upgrade classes in the future.</p>
<h1 id='how-it-works'>How It Works</h1><h2 id='how-it-works-overview'>Overview</h2>
<p>A jig is a JavaScript object that Run syncs with the blockchain. All of its code and method calls are stored on-chain in <code>op_return</code> outputs, enabling its state to be reconstructed by loading its code and replaying every method call. Every jig is paired with a Bitcoin output and only the owners of that output can make changes to the jig. All updates taken together form a transaction chain that enables consensus through user verification. This design is similar to other UTXO-based token systems because miners don&#39;t verify what is published. If anyone cheats however or publishes an incorrect update, it not only destroys the jig but is also apparent to everyone for all time.</p>

<aside class="notice">
<b>Note:</b> Non-standard scripts will enable more complex ownership models for jigs in the future.
</aside>
<h2 id='how-it-works-transaction-format'>Transaction Format</h2>
<blockquote>
<p>Sample code for a transaction</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Dragon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> <span class="p">}</span>

<span class="kr">const</span> <span class="nx">dragon</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dragon</span><span class="p">()</span>
</code></pre>
<p>The Run protocol for storing jigs and code is in development but will be well-documented, stable, and open in the future. Here is an example Bitcoin transaction.</p>

<table><thead>
<tr>
<th>Inputs</th>
<th>Outputs</th>
</tr>
</thead><tbody>
<tr>
<td>1. payment</td>
<td>1. op-return</td>
</tr>
<tr>
<td></td>
<td>2. p2pkh: Dragon Class</td>
</tr>
<tr>
<td></td>
<td>3. p2pkh: dragon jig instance</td>
</tr>
<tr>
<td></td>
<td>4. change output for payment</td>
</tr>
</tbody></table>
<h3 id='how-it-works-transaction-format-op_return-protocol'>op_return protocol</h3>
<p>The following script is used for the first output of all Run transactions: </p>

<p><code>[op_false] [op_return] &#39;run&#39; 0x00 &#39;&lt;app-id&gt;&#39; &#39;&lt;json-payload&gt;&#39; [debug-info]</code></p>

<ul>
<li>Each data field starts with an op_push specifying its length.</li>
<li>The second push data is the protocol version.</li>
<li>The app-id field enables applications to identify their Run transactions.</li>
<li>Strings are UTF-8 encoded.</li>
<li><code>[op_false] [op_return]</code> is standard on Bitcoin SV since the Quasar hard fork.</li>
<li>The JSON payload is currently encrypted. This encryption will be removed before launch.</li>
</ul>
<h3 id='how-it-works-transaction-format-json-payload'>json payload</h3>
<p><code>{</code></p>

<p><code>actions: [{ def: &quot;_o1&quot;, method: &quot;init&quot;, args: [], owner: &quot;&lt;pubkey&gt;&quot; }]</code>,</p>

<p><code>defs: [{ code: &quot;class Dragon extends Jig { }&quot;, owner: &quot;&lt;pubkey&gt;&quot; }],</code></p>

<p><code>jigs: 1</code></p>

<p><code>}</code></p>
<h2 id='how-it-works-inputs-and-outputs'>Inputs and Outputs</h2>
<p>Within a jig transaction, the inputs are the jigs which were updated from the transaction, and the outputs are the updated or newly created jigs. There may also be class and payment inputs and outputs. The jig or class for each output is determined by evaluating the updates in the <code>op_return</code>, and the resulting order is roughly the class outputs followed by the jig outputs in their order they were updated.</p>
<h2 id='how-it-works-serialization'>Serialization</h2>
<p>Jigs and other objects that are passed into methods require special serialization to be reconstructed. Run uses a custom protocol that is similar to JSON. The following data types are supported:</p>

<ul>
<li>Numbers</li>
<li>Strings</li>
<li>Booleans</li>
<li>Objects</li>
<li>Arrays</li>
<li>Jigs</li>
<li>Classes</li>
<li>Functions</li>
<li>Uint8Array</li>
</ul>

<p>Symbols are not serializable and will not be supported. Maps, Sets, and Dates, and other standard library objects are currently unsupported but will be in the future.</p>

<aside class="notice">
<b>Note:</b> Circular references of properties within the same Jig is not supported today. However, two Jigs may refer to each other.
</aside>
<h2 id='how-it-works-privacy'>Privacy</h2>
<p>All jigs and jig code are stored on-chain and are open for everyone to read. This enables anyone to reconstruct the state of any jig. Privacy is achieved similar to Bitcoin UTXOs. For maximum privacy, public keys should not be re-used. In the future, we will introduce <em>private jigs</em> that are visible only to the current owners, but by their nature, they will not work as well well with explorers, analytics and other services.</p>
<h2 id='how-it-works-security'>Security</h2>
<p>Every jig&#39;s code is sandboxed so that it does not have access to the global state which includes your funds. That provides security and also determinism when replaying a jig&#39;s history. A jig should evaluate the same in every environment. To accomplish this, Run extends the <code>vm</code> library in node and uses <code>iframe</code> sandboxing in the browser. Nonetheless, it is recommended you avoid running untrusted code.</p>

<p>Because of this sandboxing, Jigs must specify their dependencies manually by setting the <code>deps</code> property on the class. Upon creating an instance of that jig, Run will load each dependency into its own sandbox and link them together.</p>

<p>Run also protects you from performing updates on your jigs that will not be validated by others. For example, Run will throw an error if you try to change a property on a jig directly rather than call a method, or if you attempt to set a function as a property on a jig. Only top-level method calls may change a jig&#39;s state which is also enforced by Run.</p>
<h2 id='how-it-works-signing-rules'>Signing Rules</h2>
<p>The rules to determine which jigs must be spent in a Bitcoin transaction and therefore which owners are required to sign off are the following:</p>

<ol>
<li>If a method reads jigs and does not change state, then no spends are required.</li>
<li>If there are any changes to a jig&#39;s state, then all jigs written are spent.</li>
<li>If a jig changes any other jig&#39;s state or creates a new jig, then it is spent.</li>
</ol>

<p>Jigs that are only read but not written do not require their owners to sign off. They are simply referenced by their location. However, they must plausibly be in their latest state when read. Additionally, reads of immutable properties are not counted as reads by Run. Reads are only counted if the property is <em>mutable state</em> because <em>immutable state</em> would be the same for every <code>location</code> in the past.</p>
<h1 id='api-reference'>API Reference</h1><h2 id='api-reference-run'>Run</h2>
<p><code>class Run { ... }</code></p>
<h3 id='api-reference-run-constructor-options'>constructor(options)</h3>
<blockquote>
<p>Create a Run instance on Mocknet. The purse will be auto-funded.</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">network</span><span class="p">:</span> <span class="s1">'mock'</span> <span class="p">})</span>
</code></pre>
<blockquote>
<p>Create a run instance on Testnet</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// Create a run instance on testnet</span>
<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span>
  <span class="na">network</span><span class="p">:</span> <span class="s1">'test'</span><span class="p">,</span>
  <span class="na">owner</span><span class="p">:</span> <span class="s1">'cTMHbJULREfbsUFsuJLMrNbJ7VrASgWeYfFF6EgJMy49ARnNed3d'</span><span class="p">,</span>
  <span class="na">purse</span><span class="p">:</span> <span class="s1">'cQP1h2zumWrCr2zxciuNeho61QUGtQ4zBKWFauk7WEhFb8kvjRTh'</span>
<span class="p">})</span>
</code></pre>
<p><code>constructor(options: Object): Run</code></p>

<p>Creates a <code>Run</code> instance. The <code>Run</code> instance provides the network and the purse, and you need an instance to create jigs. It is the foundation of all interactions.</p>

<p>You may create a <code>Run</code> instance with either a private key, public key, or address as the owner. If you set the <code>owner</code> property to a private key, then new Jigs and classes may be created. However, if you set <code>owner</code> to a public key or address, then the Run instance will be in read-only mode and you won&#39;t be able to create new objects.</p>

<p>The <code>owner</code> is different from the <code>purse</code>. The purse also has a private key but whereas the owner is used to update jigs, the purse is used to pay for transactions. It is recommended that these be separate keys so that the bitcoin outputs are distinct. That helps both for performance and reducing the risk of another wallet not being aware that certain outputs were for jigs and accidentally destroying them.</p>

<p>Creating a new <code>Run</code> instance will automatically activate it. See <code>run.activate()</code> for more information.</p>
<h4 id='api-reference-run-constructor-options-options-object'>Options Object</h4>
<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>network</code></td>
<td>string</td>
<td>Bitcoin network, either <code>main</code>, <code>test</code>, <code>stn</code>, or <code>mock</code>.</td>
<td><code>main</code></td>
</tr>
<tr>
<td><code>owner</code></td>
<td>string</td>
<td>Private key, public key, or address used to own jigs and sign transactions</td>
<td>Randomly generated</td>
</tr>
<tr>
<td><code>app</code></td>
<td>string</td>
<td>Application id to distinguish Run transactions. See <a href="#how-it-works">How It Works</a>.</td>
<td>Empty string</td>
</tr>
<tr>
<td><code>purse</code></td>
<td><code>Pay</code> or string</td>
<td>Private key or <code>Pay</code> API used to pay for transactions. On the mock network, the purse will be funded automatically. For other networks, the user must fund the purse.</td>
<td>Randomly generated</td>
</tr>
<tr>
<td><code>blockchain</code></td>
<td><code>Blockchain</code> or string</td>
<td>Blockchain API for interacting with the Bitcoin network. Either an implementation of <code>Blockchain</code>, or one of &#39;star&#39;, &#39;bitindex&#39; or &#39;whatsonchain&#39; strings</td>
<td>&#39;star&#39;</td>
</tr>
<tr>
<td><code>state</code></td>
<td><code>State</code></td>
<td>A state API implementation that Run will use instead of the default <code>StateCache</code></td>
<td><code>new StateCache()</code></td>
</tr>
<tr>
<td><code>logger</code></td>
<td>object</td>
<td>Logging object for internal run messages. The methods that run supports on this logger are <code>debug</code>, <code>info</code>, <code>warn</code>, and <code>error</code>, and each works similar to their <code>console</code> equivalents. You only have to specify methods that need logged; Run will not log those you don&#39;t define. If <code>logger</code> is null, nothing will be logged. You may pass <code>console</code> as the logger to log everything.</td>
<td>Logs warnings and errors to the console</td>
</tr>
</tbody></table>
<h3 id='api-reference-run-load-location'>load(location)</h3>
<blockquote>
<p>Load a particular jig</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">ticketLocation</span> <span class="o">=</span> <span class="s1">'afc557ef2970af0b5fb8bc1a70a320af425c7a45ca5d40eac78475109563c5f8_o1'</span>
<span class="kr">const</span> <span class="nx">ticket</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">ticketLocation</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>Load a Jig class</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">classLocation</span> <span class="o">=</span> <span class="s1">'e4a9618d3a187448feeb95ff30f7ec6381a025316cdcae2cdf388ad3de7fab6f_o2'</span>
<span class="kr">const</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">classLocation</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">()</span>
</code></pre>
<p><code>load(location: string): Promise&lt;object|Function&gt;</code></p>

<p>Universal load method to load both jigs and jig classes or other code using their on-chain <code>location</code>. The <code>location</code> is a transaction id and output index pair and this string should usually be the jig&#39;s or class&#39;s last known <code>location</code> property. However, it is also possible to load jigs at any state in its past using other blockchain <code>location</code>s, although these will be read-only. Downloaded code will be safely sandboxed before being returned.</p>
<h3 id='api-reference-run-deploy-code'>deploy(code)</h3>
<blockquote>
<p>Upload a BigInteger class to the blockchain</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">BigInteger</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">location</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">BigInteger</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'BigInteger blockchain location'</span><span class="p">,</span> <span class="nx">location</span><span class="p">)</span>
</code></pre>
<p><code>deploy(type: Function): Promise&lt;string&gt;</code></p>

<p>Uploads code to the blockchain. Once deployment completes, the class or function will be assigned a <code>location</code> so that it may be downloaded later. It will also be assigned an <code>origin</code> and <code>owner</code>. <code>deploy</code> returns its new location in a promise. If a transaction is in progress via <code>begin</code> however, then this method will return a resolved promise, but it will not contain the location, because the location will not be known until after the transaction is complete. Code uploaded does not necessarily need to be a Jig class — any class or function will work.</p>
<h3 id='api-reference-run-sync'>sync()</h3>
<blockquote>
<p>Wait for all jigs to deploy and classes to upload before continuing</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">MyClass</span> <span class="p">{</span> <span class="p">}</span>
<span class="nx">run</span><span class="p">.</span><span class="nx">upload</span><span class="p">(</span><span class="nx">MyClass</span><span class="p">)</span>

<span class="kr">class</span> <span class="nx">MyObject</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> <span class="p">}</span>
<span class="kr">const</span> <span class="nx">jig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyObject</span><span class="p">()</span>

<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'jig origin'</span><span class="p">,</span> <span class="nx">jig</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'class origin'</span><span class="p">,</span> <span class="nx">MyClass</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">run</span><span class="p">.</span><span class="nx">owner</span><span class="p">.</span><span class="nx">jigs</span><span class="p">)</span> <span class="c1">// [jig]</span>
</code></pre>
<p><code>sync(): Promise&lt;void&gt;</code></p>

<p>Returns a promise that completes when all pending transactions are published and the owner&#39;s jigs and code are updated. After this completes, all jigs and classes will be assigned their <code>location</code>s.</p>

<aside class="notice">
<b>Note:</b> If a pending transaction fails to publish, that transaction and all subsequent transactions are reverted and the Promise is rejected.
</aside>
<h3 id='api-reference-run-owner'>owner</h3>
<p><code>owner: Owner</code></p>

<p>The owner object used to update jigs and sign transactions. See the <a href="#api-reference-owner">Owner</a> API.</p>
<h3 id='api-reference-run-purse'>purse</h3>
<p><code>purse: Purse</code></p>

<p>The purse used to pay for transactions. In the current version of Run, you should not change the purse after the Run instance is loaded.</p>
<h3 id='api-reference-run-transaction'>transaction</h3>
<p><code>transaction: Transaction</code></p>

<p>The transaction API used to build, inspect, import, and export Run bitcoin transactions. See the <a href="#api-reference-transaction">Transaction</a> API.</p>
<h3 id='api-reference-run-blockchain'>blockchain</h3>
<blockquote>
<p>Download a transaction from the blockchain</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">txid</span> <span class="o">=</span> <span class="s1">'afc557ef2970af0b5fb8bc1a70a320af425c7a45ca5d40eac78475109563c5f8'</span>
<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">blockchain</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">txid</span><span class="p">)</span>
</code></pre>
<p><code>blockchain: Blockchain</code></p>

<p>Blockchain API to access the bitcoin network. See the <a href="#api-reference-blockchain">Blockchain</a> API.</p>
<h3 id='api-reference-run-app'>app</h3>
<p><code>app: string</code></p>

<p>An application ID to distinguish Run transactions. Application developers may wish to set this in <code>Run</code>&#39;s constructor in order to find their specific transactions in third-party tools and analytics, like <a href="https://trends.cash">trends.cash</a> or <a href="https://www.whatsonchain.com">WhatsOnChain</a>. This string will be UTF-8 encoded and stored in the 5th chunk of the <code>op_return</code> script. For more details about the protocol, see <a href="#how-it-works">How It Works</a>.</p>

<aside class="warning">
<b>Warning:</b> Anyone may set the <code>app</code> string to anything, so it is not a secure way to find only your app's transactions.
</aside>
<h3 id='api-reference-run-activate'>activate()</h3>
<p><code>activate()</code></p>

<p>Sets this instance to <code>Run.instance</code>, the active <code>Run</code> instance. All jig instantiations, updates, and class deployments will occur on the active run instance. The owner of that instance will sign transactions and its blockchain and purse are the ones which will be used. <code>activate()</code> will also assign <code>bsv.Networks.defaultNetwork</code> to be the active Run&#39;s network configuration. </p>
<h3 id='api-reference-run-static-instance'>static instance</h3>
<p><code>static instance: Run</code></p>

<p>The currently active <code>Run</code> instance. All jig instantiations, updates, and class deployments will occur on the active run instance. The owner of that instance will sign transactions and its blockchain and purse are the ones which will be used. You may change the active Run instance either by calling <code>run.activate()</code> or by creating a new <code>Run</code> instance.</p>
<h3 id='api-reference-run-static-version'>static version</h3>
<p><code>static version: string</code></p>

<p>Version of the Run library</p>
<h3 id='api-reference-run-static-jig'>static Jig</h3>
<blockquote>
<p>Create a custom jig that extends the Jig base class</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">MyObject</span> <span class="kr">extends</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">Jig</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre>
<p><code>static Jig: Jig</code></p>

<p><code>Jig</code> class that is common for all <code>Run</code> instances. It is set as <code>Jig</code> at the global scope. You must extend from this base class to create a jig. See the <a href="#api-reference-jig">Jig</a> API.</p>
<h3 id='api-reference-run-static-token'>static Token</h3>
<p><code>static Token: Token</code></p>

<p><code>Token</code> class that is common for all <code>Run</code> instances. It is set as <code>Token</code> at the global scope. See the <a href="#api-reference-token">Token</a> API.</p>
<h3 id='api-reference-run-static-expect'>static expect</h3>
<p><code>static expect: expect</code></p>

<p><code>expect</code> function that may be used as a dependency in Jigs to check parameters. It is is global for all <code>Run</code> instances. See the <a href="#api-reference-expect">expect</a> API.</p>
<h3 id='api-reference-run-static-mockchain'>static Mockchain</h3>
<p><code>static Mockchain: Mockchain</code></p>

<p>See the <a href="#api-reference-mockchain">Mockchain</a> API.</p>
<h3 id='api-reference-run-static-statecache'>static StateCache</h3>
<p><code>static StateCache: StateCache</code></p>

<p>See the <a href="#api-reference-statecache">StateCache</a> API.</p>
<h2 id='api-reference-jig'>Jig</h2>
<p><code>class Jig { ... }</code></p>
<h3 id='api-reference-jig-init'>init()</h3>
<blockquote>
<p>Simple jig that takes two parameters in its constructor</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">SimpleStore</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">a</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleStore</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span> <span class="c1">// prints 2</span>
</code></pre>
<p><code>init(): Jig</code></p>

<p><code>init()</code> is equivalent in jigs to <code>constructor()</code> for regular classes. The user may pass parameters to it and call <code>super.init()</code> to call parent constructors. <code>init()</code> may not be called directly by users because Run will call it automatically when the class is instantiated. Also, jigs are not allowed to have a <code>constructor()</code> method because <code>init()</code> is used instead.</p>
<h3 id='api-reference-jig-sync'>sync()</h3>
<p><code>sync(options: ?object): Promise&lt;void&gt;</code></p>

<p>Synchronizes this jig with the blockchain by waiting for all pending transactions to publish and updating the jig with any new transactions from the network. If you pass <code>{ forward: false }</code>, then only the pending transactions will be published and a new state won&#39;t need download. This may be useful for performance or if the Blockchain API does not support forward syncing, as is the case with WhatsOnChain.</p>
<h3 id='api-reference-jig-origin'>origin</h3>
<blockquote>
<p>Two different tickets have different origins</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Ticket</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> <span class="p">}</span>
<span class="kr">const</span> <span class="nx">ticket1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ticket</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">ticket2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ticket</span><span class="p">()</span>
<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>
<span class="c1">// ticket1.origin !== ticket2.origin</span>
</code></pre>
<p><code>origin: string</code></p>

<p>The unique blockchain location where the jig was initially deployed distinguishing the jig from all others. The format is <code>TXID_oN</code> where <code>TXID</code> is the bitcoin transaction ID where the jig was first deployed. <code>o</code> is shorthand for <em>output</em> and <code>N</code> is the zero-based index for the P2PKH output representing this jig. The origin is set automatically by Run after deploying the jig and it becomes read-only afterward. Jig methods may internally read the origin anytime after it is initially published.</p>
<h3 id='api-reference-jig-location'>location</h3>
<blockquote>
<p>The value of <code>location</code> changes with every update</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Weapon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">upgrade</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">upgraded</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="k">return</span> <span class="k">this</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">weapon</span> <span class="o">=</span> <span class="nx">await</span> <span class="k">new</span> <span class="nx">Weapon</span><span class="p">().</span><span class="nx">sync</span><span class="p">()</span>
<span class="c1">// weapon.origin === weapon.location</span>
<span class="nx">await</span> <span class="nx">weapon</span><span class="p">.</span><span class="nx">uprade</span><span class="p">().</span><span class="nx">sync</span><span class="p">()</span>
<span class="c1">// weapon.origin !== weapon.location</span>
</code></pre>
<p><code>location: string</code></p>

<p>The blockchain location representing the current state of the jig. This is a P2PKH output and is in the same form as <code>origin</code>. However, unlike <code>origin</code>, <code>location</code> will update with every state change on the jig.</p>

<p>When there is a pending change, reading <code>location</code> will throw an error. This is because the Bitcoin transaction id is not yet known. The user should call <code>sync</code> first to avoid this error. Finally, note that this is a read-only property that Run updates for you, and it may only be read outside of jig methods.</p>
<h3 id='api-reference-jig-owner'>owner</h3>
<blockquote>
<p>Sending a jig to a new owner</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Item</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">send</span><span class="p">(</span><span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">owner</span> <span class="o">=</span> <span class="nx">to</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Item</span><span class="p">()</span>
<span class="nx">item</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">'0261b44db219de925b85e8f26cbfe551e31bf25678b8ff9512bca03aea218e9258'</span><span class="p">)</span>
</code></pre>
<p><code>owner: string</code></p>

<p>The public key string representing the owner of this jig. This is equivalent to the public key for the current P2PKH output of the jig&#39;s location. The jig may change this property to change owners, but it is read-only from outside the jig.</p>
<h3 id='api-reference-jig-satoshis'>satoshis</h3>
<blockquote>
<p>Backing a jig with Bitcoin</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Item</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">back</span><span class="p">(</span><span class="nx">satoshis</span><span class="p">)</span> <span class="p">{</span> 
    <span class="k">this</span><span class="p">.</span><span class="nx">satoshis</span> <span class="o">=</span> <span class="nx">satoshis</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p><code>satoshis: number</code></p>

<p>This number represents the amount of Bitcoin in satoshis that are backing this jig. It may be increased or decreased but it may not be set below zero. Increasing this value will deposit Bitcoin into the output for the jig from the Run purse. Decreasing it will withdraw Bitcoin to the Run purse. It may only be changed from within a Jig. If the satoshi value in the output is less than the value in the jig, the jig is automatically invalidated.</p>
<h2 id='api-reference-owner'>Owner</h2>
<p><code>class Owner { ... }</code></p>

<p>Owner used to update jigs and sign transactions.</p>
<h3 id='api-reference-owner-jigs'>jigs</h3>
<blockquote>
<p>Load all jigs that are tickets</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// Update the owner's jigs</span>
<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="c1">// Find the ticket</span>
<span class="kr">const</span> <span class="nx">ticketClassOrigin</span> <span class="o">=</span> <span class="s1">'e4a9618d3a187448feeb95ff30f7ec6381a025316cdcae2cdf388ad3de7fab6f_o1'</span>
<span class="kr">const</span> <span class="nx">ticket</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">owner</span><span class="p">.</span><span class="nx">jigs</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">jig</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">origin</span> <span class="o">===</span> <span class="nx">ticketClassOrigin</span><span class="p">)</span>
</code></pre>
<p><code>jigs: Array&lt;Jig&gt;</code></p>

<p>Returns an array of all jigs owned by the Run owner. This array is cached. To update it, call <code>run.sync()</code>.</p>
<h3 id='api-reference-owner-code'>code</h3>
<blockquote>
<p>Load the user&#39;s jig classes and instantiates the first one</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// Update the owner's code</span>
<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="c1">// Find a particular class</span>
<span class="kr">const</span> <span class="nx">MyJigClass</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">code</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">code</span> <span class="o">=&gt;</span> <span class="nx">code</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">'MyJigClass'</span><span class="p">)</span>
</code></pre>
<p><code>code: Array&lt;Class|Function&gt;</code></p>

<p>An array of all jig classes and other code owned by the Run owner. This array is cached. To update it, call <code>run.sync()</code>.</p>
<h3 id='api-reference-owner-privkey'>privkey</h3>
<p><code>privkey: ?string</code></p>

<p>The private key of the owner, if it exists.</p>
<h3 id='api-reference-owner-pubkey'>pubkey</h3>
<p><code>pubkey: ?string</code></p>

<p>The public key of the owner, if it exists.</p>
<h3 id='api-reference-owner-address'>address</h3>
<p><code>address: string</code></p>

<p>The Bitcoin address of the owner.</p>
<h2 id='api-reference-transaction'>Transaction</h2>
<p><code>class Transaction { ... }</code></p>

<p>The Transaction API allows you to manipulate the current Bitcoin transaction being built by Run. This class is instantiated automatically for you with each Run instance, and it is accessible via <code>run.transaction</code>. It allows you to:</p>

<ul>
<li>Batch many jig updates together</li>
<li>Load and inspect transactions</li>
<li>Export transactions for others to co-sign</li>
<li>Sign transactions involving your jigs</li>
<li>Propose atomic swaps and other updates that involve multiple parties</li>
</ul>

<p>Normally, when you are updating a jig that you own, Run will begin a transaction for you automatically. However, you can take control of this process by calling <code>begin</code> yourself. This starts a new transaction, and any updates you perform after <code>begin</code> will not be broadcasted until you call <code>end</code>. Alternatively, you may cancel the updates by calling <code>rollback</code> or export the Bitcoin transaction by calling <code>export</code>.</p>

<p>Other parties may load your exported transaction by calling <code>import</code> and then inspect its contents using <code>actions</code>. If they approve of the updates to their jigs, they may call <code>sign</code> and then <code>end</code> to broadcast the transaction.</p>
<h3 id='api-reference-transaction-begin'>begin()</h3>
<blockquote>
<p>Create a counter and increment it twice in one transaction</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">begin</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">counter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Counter</span><span class="p">()</span>
<span class="nx">counter</span><span class="p">.</span><span class="nx">inc</span><span class="p">()</span>
<span class="nx">counter</span><span class="p">.</span><span class="nx">inc</span><span class="p">()</span>
<span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
</code></pre>
<p><code>begin()</code></p>

<p>Begins a batch transaction. All jig instantiations and updates will be delayed until <code>end</code> is called, at which point a single transaction that combines all previous actions will be published. Using batch transactions will reduce transaction size and per-action cost when there are multiple actions. Transactions may also be nested and only when the final <code>end</code> is called will the transaction be published.</p>

<aside class="notice">
<b>Note:</b> If the transaction fails to post, then all actions in the batch are reverted.
</aside>
<h3 id='api-reference-transaction-end'>end()</h3>
<p><code>end()</code></p>

<p>Ends a previous batch transaction started with <code>begin</code> and adds it to a background queue to submit to the blockchain.</p>
<h3 id='api-reference-transaction-export'>export()</h3>
<p><code>export(): bsv.Transaction</code></p>

<p>Exports the in-progress transaction created via <code>begin()</code> or loaded via `import().</p>
<h3 id='api-reference-transaction-import'>import()</h3>
<p><code>import(tx: bsv.Transaction): Promise&lt;void&gt;</code></p>

<p>Imports a transaction into Run to be updated or broadcasted. If the transaction is not a valid Run transaction, then this method will throw an error.</p>
<h3 id='api-reference-transaction-rollback'>rollback()</h3><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Store</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">set</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Store</span><span class="p">()</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">begin</span><span class="p">()</span>

<span class="nx">store</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'Hello, world'</span><span class="p">)</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">rollback</span><span class="p">()</span>

<span class="c1">// store.value is undefined again</span>
</code></pre>
<p><code>rollback()</code></p>

<p>Reverts all updates in the current transaction which must be started with <code>begin</code> or loaded with <code>import</code>. Any classes to be deployed will have their origins and locations cleared, and any jigs to be updated will revert to their prior state. Any jigs that are deployed for their first time will be reverted to an invalid state where they may no longer be used. If no transaction is in progress, then this method throws an error. You cannot roll back actions that were not part of a transaction created with <code>begin</code> or <code>import</code>.</p>
<h3 id='api-reference-transaction-pay'>pay()</h3>
<p><code>pay(): Promise&lt;void&gt;</code></p>

<p>Pays for the current transaction. This is performed automatically when <code>end()</code> is called, but if the transaction is exported, then the user must explicitely call <code>pay()</code> before signing the transaction. If any additional updates are made to the transaction, including calling jig methods or deploying new code, then the transaction must be paid for again.</p>
<h3 id='api-reference-transaction-sign'>sign()</h3>
<p><code>sign(): Promise&lt;void&gt;</code></p>

<p>Signs all updates involved in the current transaction using the current Run owner. The transaction should only be signed after all updates are made, and the transaction has been paid for via <code>pay()</code>. After all required signatures are added, then the transaction may be broadcasted, and if the transaction requires signatures from multiple different owners, then it must exported and imported by other parties to be signed. If any additional updates are made to the transaction, including calling jig methods or deploying new code, then the signatures are reset and the transaction must be paid for again and re-signed by all parties.</p>
<h3 id='api-reference-transaction-actions'>actions</h3>
<p><code>actions: Array&lt;{ target: Jig, method: string, args: Array&lt;any&gt; }&gt;</code></p>

<p>The jig updates performed in this transaction.</p>
<h2 id='api-reference-token'>Token</h2>
<p><code>class Token extends Jig { ... }</code></p>

<p><code>Token</code> is a jig for fungible tokens similar to ERC-20 or SLP. It may be used for shares, loyalty points, gift cards, and more. Each <code>Token</code> instance defines a numerical amount held by its owner. You extend from <code>Token</code> to define a new kind of token. As the owner of this new token <em>class</em>, only you can mint new token instances. The token instances you mint though may be sent, owned, and even combined together by others.</p>

<p><code>Token</code> supports integer amounts like ERC-20 in its <code>amount</code> field. However, oftentimes you may wish to display the token&#39;s amount with a decimal, like <code>1.50</code>. The <code>static decimals</code> property may be used to declare how the Token&#39;s amount is to be displayed, and the <code>value</code> property returns the amount shifted by the decimal places. In this example, <code>amount</code> would be 150 and <code>decimals</code> would be 2.</p>
<h3 id='api-reference-token-constructor-amount'>constructor(amount)</h3>
<blockquote>
<p>Minting a new token</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">MyCustomToken</span> <span class="kr">extends</span> <span class="nx">Token</span> <span class="p">{</span> <span class="p">}</span>

<span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCustomToken</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</code></pre>
<p><code>init(amount: number): Token</code></p>

<p><code>init()</code> mints a new token with a specified amount. Only the owner of the extended token class is able to call this method.</p>
<h3 id='api-reference-token-send-to-amount'>send(to, amount)</h3><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCustomToken</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">change</span> <span class="o">=</span> <span class="nx">token</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">pubkey</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">amount</span><span class="p">)</span> <span class="c1">// 20</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">change</span><span class="p">.</span><span class="nx">amount</span><span class="p">)</span> <span class="c1">// 80</span>
</code></pre>
<p><code>send(to: string, amount: ?number): Token</code></p>

<p>Sends this token to another user. If the <code>amount</code> specified is less than the <code>amount</code> in the token, then a change token will be returned back to the current owner. If the <code>amount</code> is not specified, then the entire token is sent and the return value is <code>null</code>.</p>
<h3 id='api-reference-token-amount'>amount</h3>
<p><code>amount: number</code></p>

<p>The integer value held within this token. The meaning of <code>amount</code> depends on the token.</p>
<h3 id='api-reference-token-value'>value</h3>
<p><code>value: number</code></p>

<p>The amount contained in this token shifted by <code>Token.decimals</code>.</p>
<h3 id='api-reference-token-static-combine-tokens'>static combine(...tokens)</h3>
<blockquote>
<p>Combining three tokens newly minted</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">token1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCustomToken</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">token2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCustomToken</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">token3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCustomToken</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">combined</span> <span class="o">=</span> <span class="nx">MyCustomToken</span><span class="p">.</span><span class="nx">combine</span><span class="p">(</span><span class="nx">token1</span><span class="p">,</span> <span class="nx">token2</span><span class="p">,</span> <span class="nx">token3</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">combine</span><span class="p">.</span><span class="nx">amount</span><span class="p">)</span> <span class="c1">// 60</span>
</code></pre>
<blockquote>
<p>Combining and sending tokens in a single transaction</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">begin</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">tokens</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">owner</span><span class="p">.</span><span class="nx">jigs</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">jig</span> <span class="o">=&gt;</span> <span class="nx">jig</span> <span class="k">instanceof</span> <span class="nx">MyCustomToken</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">combined</span> <span class="o">=</span> <span class="nx">MyCustomToken</span><span class="p">.</span><span class="nx">combine</span><span class="p">(...</span><span class="nx">tokens</span><span class="p">)</span>

<span class="nx">combined</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">address</span><span class="p">,</span> <span class="nx">amount</span><span class="p">)</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
</code></pre>
<p><code>static combine(...tokens: Token): Token</code></p>

<p><code>combine</code> will merge the multiple tokens into a single token that has the the combined amount. The tokens to combine must all be the same kind and the returned token object will be an instance of that same class too.</p>

<p>Tokens are like Bitcoin outputs. Every time you send some tokens, you split off an amount into a new output. Just like Bitcoins, you may later want to merge them back together. It is often useful to do this right before sending your tokens so that you can send their full amount. The example on the right shows how to combine and send tokens in a single transaction.</p>
<h3 id='api-reference-token-static-decimals'>static decimals</h3><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">USDToken</span> <span class="kr">extends</span> <span class="nx">Token</span> <span class="p">{</span> <span class="p">}</span>

<span class="nx">USDToken</span><span class="p">.</span><span class="nx">decimals</span> <span class="o">=</span> <span class="mi">2</span>

<span class="kr">const</span> <span class="nx">dollars</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">USDToken</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">dollars</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="c1">// 1.00</span>
</code></pre>
<p><code>static decimals: number</code></p>

<p>The number of decimal places to shift the <code>amount</code> when displaying it. <code>Token</code> uses integers by default for precision, just like ERC-20, but often times you will want to specify a decimals value to indicate a unit for display to the user. For example, a US Dollar coin might set decimals to 2 so that the base amount is cents but the display value is dollars. The <code>value</code> property will return <code>amount</code> shifted by this number of decimals.</p>
<h2 id='api-reference-expect'>expect</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Post</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">message</span><span class="p">).</span><span class="nx">toBeString</span><span class="p">()</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Post</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="na">expect</span><span class="p">:</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">expect</span> <span class="p">}</span>
</code></pre>
<p><code>function expect(subject) { ... }</code></p>

<p>The <code>expect</code> function is arbitrary code to assist with parameter checking in Jigs. It is similar to Jest and Chai assertions. <code>expect</code> takes a single argument, <em>subject</em>, and then lets you execute one of its assertion methods. If the assertion passes, then nothing happens, but if it fails, an Error is thrown. See the example to the right for how to check if a parameter is a string.</p>

<p>Each method takes an parameter <em>message</em> that is the error message to throw. If none is specified, then a default error message will be created that describes what is being checked.</p>
<h3 id='api-reference-expect-not'>.not</h3><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">name</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBeNumber</span><span class="p">()</span>
</code></pre>
<p><code>.not</code></p>

<p>The <code>not</code> property reverses the condition of any methods that follow.</p>
<h3 id='api-reference-expect-tobe'>.toBe()</h3><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">power</span> <span class="o">&gt;</span> <span class="mi">9999</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</code></pre>
<p><code>.toBe(value: any, message: ?string)</code></p>

<p>Checks that the <em>subject</em> is equal to the <em>value</em>, using the javascript === operator. This does not, however, deeply compare values of an object, so for deep object comparison we recommend <code>toEqual</code>.</p>
<h3 id='api-reference-expect-toequal'>.toEqual()</h3><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">names</span><span class="p">).</span><span class="nx">toBe</span><span class="p">([</span><span class="s1">'Stevie'</span><span class="p">,</span> <span class="s1">'Wonder'</span><span class="p">])</span>
</code></pre>
<p><code>.toEqual(value: any, message: ?string)</code></p>

<p>Deeply compares the <em>subject</em> to a <em>value</em>, which involves recursively traversing through every sub-property of objects to compare whether they are the same primitive values.</p>
<h3 id='api-reference-expect-tobeinstanceof'>.toBeInstanceOf()</h3><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">dragon</span><span class="p">).</span><span class="nx">toBeInstanceOf</span><span class="p">(</span><span class="nx">Dragon</span><span class="p">)</span>
</code></pre>
<p><code>.toBeInstanceOf(Class: Class, message: ?string)</code></p>

<p>Checks that an object is an instance of a class or one of its parents.</p>
<h3 id='api-reference-expect-tobedefined'>.toBeDefined()</h3><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">message</span><span class="p">).</span><span class="nx">toBeDefined</span><span class="p">()</span>
</code></pre>
<p><code>.toBeDefined(message: ?string)</code></p>

<p>Checks that a <em>value</em> is not undefined.</p>
<h3 id='api-reference-expect-tobenull'>.toBeNull()</h3><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">hat</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBeNull</span><span class="p">()</span>
</code></pre>
<p><code>.toBeNull(message: ?string)</code></p>

<p>Checks that a <em>value</em> is null. Often this is paired with <code>not</code> to check that a value is not null, as seen on the right.</p>
<h3 id='api-reference-expect-tobenumber'>.toBeNumber()</h3><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">health</span><span class="p">).</span><span class="nx">toBeNumber</span><span class="p">()</span>
</code></pre>
<p><code>.toBeNumber(message: ?string)</code></p>

<p>Checks that a <em>value</em> is a numerical type. Numbers including all integers, floating point numbers, NaN, and Infinity.</p>
<h3 id='api-reference-expect-tobeinteger'>.toBeInteger()</h3><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">amount</span><span class="p">).</span><span class="nx">toBeInteger</span><span class="p">()</span>
</code></pre>
<p><code>.toBeInteger(message: ?string)</code></p>

<p>Checks that a <em>value</em> is an integer number and does not have a decimal point.</p>
<h3 id='api-reference-expect-tobelessthan'>.toBeLessThan()</h3><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">damage</span><span class="p">).</span><span class="nx">toBeLessThan</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</code></pre>
<p><code>.toBeLessThan(value: number, message: ?string)</code></p>

<p>Checks that a <em>value</em> is a number less than a particular number.</p>
<h3 id='api-reference-expect-tobelessthanorequalto'>.toBeLessThanOrEqualTo()</h3>
<p><code>.toBeLessThanOrEqualTo(value: number, message: ?string)</code></p>

<p>Checks that a <em>value</em> is a number less than or equal to a particular number.</p>
<h3 id='api-reference-expect-tobegreaterthan'>.toBeGreaterThan()</h3><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span><span class="p">).</span><span class="nx">toBeGreaterThan</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre>
<p><code>.toBeGreaterThan(value: number, message: ?string)</code></p>

<p>Checks that a <em>value</em> is a number greater than a particular number.</p>
<h3 id='api-reference-expect-tobegreaterthanorequalto'>.toBeGreaterThanOrEqualTo()</h3>
<p><code>.toBeGreaterThanOrEqualTo(value: number, message: ?string)</code></p>

<p>Checks that a <em>value</em> is a number greater than or equal to a particular number.</p>
<h3 id='api-reference-expect-tobeboolean'>.toBeBoolean()</h3><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">weaponsEnabled</span><span class="p">).</span><span class="nx">toBeBoolean</span><span class="p">()</span>
</code></pre>
<p><code>.toBeBoolean(message: ?string)</code></p>

<p>Checks that a <em>value</em> is either true or false.</p>
<h3 id='api-reference-expect-tobestring'>.toBeString()</h3><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">name</span><span class="p">).</span><span class="nx">toBeString</span><span class="p">()</span>
</code></pre>
<p><code>.toBeString(message: ?string)</code></p>

<p>Checks that a <em>value</em> is a string. It may still be the empty string however.</p>
<h3 id='api-reference-expect-tobeobject'>.toBeObject()</h3><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">properties</span><span class="p">).</span><span class="nx">toBeObject</span><span class="p">()</span>
</code></pre>
<p><code>.toBeObject(message: ?string)</code></p>

<p>Checks that a <em>value</em> is a non-null object or an Array. </p>
<h3 id='api-reference-expect-tobearray'>.toBeArray()</h3><pre class="highlight plaintext"><code>expect(tokens).toBeArray()
</code></pre>
<p><code>.toBeArray(message: ?string)</code></p>

<p>Checks that a <em>value</em> is an array and is not null. It may however be empty.</p>
<h3 id='api-reference-expect-tobeclass'>.toBeClass()</h3><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">Dragon</span><span class="p">).</span><span class="nx">toBeClass</span><span class="p">()</span>
</code></pre>
<p><code>.toBeClass(message: ?string)</code></p>

<p>Checks that a type is a class.</p>
<h3 id='api-reference-expect-tobefunction'>.toBeFunction()</h3><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">calculateDamage</span><span class="p">).</span><span class="nx">toBeFunction</span><span class="p">()</span>
</code></pre>
<p><code>.toBeFunction(message: ?string)</code></p>

<p>Checks that a type is a function. Classes are not considered functions for this assert.</p>
<h2 id='api-reference-blockchain'>Blockchain</h2>
<p><code>class Blockchain { ... }</code></p>

<p>The interface run uses to communicate with the Bitcoin network. Run ships with several implementations by default including the mockchain and three REST APIs. Developers may implement <code>Blockchain</code> to connect to the Bitcoin network in custom ways.</p>
<h3 id='api-reference-blockchain-network'>network</h3>
<p><code>network: string</code></p>

<p>The general kind of network that Run connects to. One of <code>main</code>, <code>test</code>, <code>stn</code>, or <code>mock</code>.</p>
<h3 id='api-reference-blockchain-broadcast-tx'>broadcast(tx)</h3>
<blockquote>
<p>Create and broadcast a simple transaction</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">bsv</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">().</span><span class="nx">from</span><span class="p">(</span><span class="nx">utxo</span><span class="p">).</span><span class="nx">to</span><span class="p">(</span><span class="nx">address</span><span class="p">,</span> <span class="nx">amount</span><span class="p">).</span><span class="nx">sign</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">blockchain</span><span class="p">.</span><span class="nx">submit</span><span class="p">(</span><span class="nx">tx</span><span class="p">)</span>
</code></pre>
<p><code>broadcast(tx: bsv.Transaction): Promise&lt;void&gt;</code></p>

<p>Submits a transaction to the network. A promise is returned that will resolve if the transaction was accepted or rejected with the error if the network did not accept the transaction.</p>

<p>The base class method throws an unimplemented error, so this must be overridden in derived blockchain classes.</p>
<h3 id='api-reference-blockchain-fetch-txid'>fetch(txid)</h3>
<blockquote>
<p>Downloads a transaction from the network</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">txid</span> <span class="o">=</span> <span class="s1">'afc557ef2970af0b5fb8bc1a70a320af425c7a45ca5d40eac78475109563c5f8'</span>
<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">blockchain</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">txid</span><span class="p">)</span>
</code></pre>
<p><code>fetch(txid: string, force: ?boolean): Promise&lt;bsv.Transaction&gt;</code></p>

<p>Downloads a transaction from the network. A promise is returned that will resolve with the transaction parsed using the <code>bsv</code> library or reject with the error if the transaction could not be returned. The optional <code>force</code> parameter requests that <code>fetch</code> re-query the blockchain and not return a cached copy. The returned transaction should also have additional properties set:</p>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>time</code></td>
<td>number</td>
<td>yes</td>
<td>The time in milliseconds when the transaction was accepted by a miner or included in a block.</td>
</tr>
<tr>
<td><code>blocktime</code></td>
<td>number</td>
<td>no</td>
<td>The time in milliseconds when the transaction was included in a block.</td>
</tr>
<tr>
<td><code>confirmations</code></td>
<td>number</td>
<td>no</td>
<td>The number of block confirmations for this transaction</td>
</tr>
<tr>
<td><code>blockhash</code></td>
<td>string</td>
<td>no</td>
<td>The hash of the block this transaction was included in</td>
</tr>
<tr>
<td><code>blockheight</code></td>
<td>number</td>
<td>no</td>
<td>The height of the block this transaction was included in, or -1 if the transaction is in the mempool.</td>
</tr>
<tr>
<td><code>outputs[i].spentTxId</code></td>
<td>string</td>
<td>no</td>
<td>The transaction id that spends this output, or null if unspent. This is required for forward syncing.</td>
</tr>
<tr>
<td><code>outputs[i].spentIndex</code></td>
<td>number</td>
<td>no</td>
<td>The input index in the transaction that spends this output, or null if unspent.</td>
</tr>
<tr>
<td><code>outputs[i].spentHeight</code></td>
<td>number</td>
<td>no</td>
<td>The block height of the transaction that spends this output, or -1 if the transaction is in the mempool.</td>
</tr>
</tbody></table>

<p>The base class method throws an unimplemented error, so this must be overridden in derived blockchain classes.</p>
<h3 id='api-reference-blockchain-utxos-address'>utxos(address)</h3>
<blockquote>
<p>Downloads the current UTXOs for a given address</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">address</span> <span class="o">=</span> <span class="s1">'mpBU73vq9ajhkXknP1sNGe6wjXH7QtwmWm'</span>
<span class="kr">const</span> <span class="nx">utxos</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">blockchain</span><span class="p">.</span><span class="nx">utxos</span><span class="p">(</span><span class="nx">address</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">bsv</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">().</span><span class="nx">from</span><span class="p">(</span><span class="nx">utxos</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="nx">address</span><span class="p">)</span>
</code></pre>
<p><code>utxos(address: string): Promise&lt;Array&lt;{txid: string, vout: number, script: bsv.Script, satoshis: number}&gt;&gt;</code></p>

<p>Returns the unspent outputs for a given address. A promise is returned that will resolve with an array of UTXOs, which may be empty, or reject with an error. Each returned UTXO may be converted to a <code>bsv.Transaction.UnspentOutput</code> by passing it into the constructor.</p>

<p>The base class method throws an unimplemented error, so this must be overridden in derived blockchain classes.</p>
<h2 id='api-reference-mockchain'>Mockchain</h2>
<blockquote>
<p>Getting the mockchain from a run instance</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">network</span><span class="p">:</span> <span class="s1">'mock'</span> <span class="p">})</span>

<span class="kr">const</span> <span class="nx">mockchain</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">blockchain</span>
</code></pre>
<blockquote>
<p>Creating a mockchain manually and passing it into <code>Run</code></p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">mockchain</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">Mockchain</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">blockchain</span><span class="p">:</span> <span class="nx">mockchain</span> <span class="p">})</span>
</code></pre>
<p><code>class Mockchain implements Blockchain { ... }</code></p>

<p>The <em>mockchain</em> is a local simulation of a blockchain that stored entirely in memory. It accepts and validates real Bitcoin transactions using testnet settings. The mockchain simulates many aspects of a real Bitcoin API, including the 25 chained mempool limit, but everything happens locally.</p>

<p>We recommend using the mockchain during development and unit testing. The mockchain lets you simulate Run without requiring network connectivity and without spending real bitcoins. Note that when the program closes however, all mockchain data is lost, so it is not a substitute for a real network.</p>

<p>The class is accessible via <code>Run.Mockchain</code>, or as an instance in <code>run.blockchain</code> after setting the network to <code>mock</code>.</p>
<h3 id='api-reference-mockchain-constructor'>constructor()</h3>
<p><code>constructor()</code></p>

<p>Creates a new mockchain. There are no parameters.</p>
<h3 id='api-reference-mockchain-fund-address-satoshis'>fund(address, satoshis)</h3>
<p><code>fund(address: string, satoshis: number)</code></p>

<p>Directly funds an address with an amount of satoshis without requiring the spending of any inputs. The Run class will automatically fund the initial purse, but you may fund additional addresses using this method.</p>
<h3 id='api-reference-mockchain-block'>block()</h3>
<p><code>block()</code></p>

<p>Creates a new simulated block. This is useful when the 25 chained mempool limit is hit.</p>
<h2 id='api-reference-pay'>Pay</h2>
<p><code>class Pay { ... }</code></p>

<p>The interface to pay for transactions and implement purse functionality in Run. The default <code>Pay</code> implementation is <a href="#purse-api">Purse</a></p>

<p>The base class method throws an unimplemented error, so this must be overridden in derived classes.</p>
<h3 id='api-reference-pay-pay'>pay()</h3>
<blockquote>
<p>Pay for a transaction using specific UTXOs</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">PayWithUtxos</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">utxos</span><span class="p">,</span> <span class="nx">privateKey</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">utxos</span> <span class="o">=</span> <span class="nx">utxos</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">privateKey</span>
    <span class="p">}</span>

    <span class="nx">async</span> <span class="nx">pay</span><span class="p">(</span><span class="nx">tx</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">utxos</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">.</span><span class="nx">toAddress</span><span class="p">()).</span><span class="nx">sign</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">purse</span><span class="p">:</span> <span class="k">new</span> <span class="nx">PayWithUtxos</span><span class="p">(</span><span class="nx">utxos</span><span class="p">,</span> <span class="nx">privateKey</span><span class="p">)</span> <span class="p">})</span>
</code></pre>
<p><code>pay(tx: bsv.Transaction): Promise&lt;bsv.Transaction&gt;</code></p>

<p>Adds payment inputs and outputs so that a Jig transaction will be accepted by miners. This is an asynchronous call that returns a promise. If an error is thrown, then state of all jigs in the current transaction will be reverted and the transaction will not be broadcasted.</p>
<h2 id='api-reference-purse'>Purse</h2>
<p><code>class Purse implements Pay { ... }</code></p>

<p>The purse that Run uses by default to pay for transactions using a local wallet. This is an implementation of the <code>Pay</code> API.</p>
<h3 id='api-reference-purse-privkey'>privkey</h3>
<p><code>privkey: string</code></p>

<p>Private key used to sign the transaction.</p>
<h3 id='api-reference-purse-address'>address</h3>
<p><code>address: string</code></p>

<p>Address used to find UTXOs and receive payments.</p>
<h3 id='api-reference-purse-splits'>splits</h3>
<blockquote>
<p>Change the number of purse UTXO splits</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">run</span><span class="p">.</span><span class="nx">purse</span><span class="p">.</span><span class="nx">splits</span> <span class="o">=</span> <span class="mi">100</span>
</code></pre>
<p><code>splits: number</code></p>

<p>The minimum number of UTXOs that the purse must have. If the number of UTXOs is less than this value, then Run will automatically split your UTXOs the next time a Run transaction is generated. The default value for <code>splits</code> is 10.</p>

<p>Increasing this value may avoid the <code>too-long-mempool-chain</code> error. For more information, see <a href="#advanced-usage-debugging-tips">Debugging Tips</a>.</p>
<h3 id='api-reference-purse-balance'>balance()</h3>
<blockquote>
<p>Querying the current balance</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Satoshis'</span><span class="p">,</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">purse</span><span class="p">.</span><span class="nx">balance</span><span class="p">())</span>
</code></pre>
<p><code>balance(): Promise&lt;number&gt;</code></p>

<p>Returns a promise that resolves to the current balance in satoshis of this purse. This is the sum of all satoshis in this purse&#39;s unspent outputs.</p>
<h3 id='api-reference-purse-utxos'>utxos()</h3>
<blockquote>
<p>Building a transaction using the purse</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">utxos</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">purse</span><span class="p">.</span><span class="nx">utxos</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">bsv</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">().</span><span class="nx">from</span><span class="p">(</span><span class="nx">utxos</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="nx">run</span><span class="p">.</span><span class="nx">purse</span><span class="p">.</span><span class="nx">address</span><span class="p">).</span><span class="nx">sign</span><span class="p">(</span><span class="nx">run</span><span class="p">.</span><span class="nx">purse</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">)</span>
</code></pre>
<p><code>utxos(): Promise&lt;{txid: string, vout: number, script: bsv.Script, satoshis: number}&gt;</code></p>

<p>Returns a promise that resolves to the current UTXOs of this purse.</p>
<h2 id='api-reference-state'>State</h2>
<p><code>class State { ... }</code></p>

<p>The interface for Run&#39;s state cache. The state cache is responsible for storing intermediate jig states so that they do not need to be recomputed from their history each time they are loaded. This API also enables third-party state servers to exist that provide intermediate state for jigs.</p>
<h3 id='api-reference-state-get-location'>get(location)</h3>
<p><code>get(location: string): Promise&lt;?object&gt;</code></p>

<p>Gets the state for a particular location. Run will call this when loading jigs to see if it can short-circuit its loading. If a state exists and is valid, its state object should be returned. The state object is custom and should never be created from scratch. Instead, values should come from previous <code>set</code> calls to the State API. This method is asyncronous to allow for third-party network calls.</p>
<h3 id='api-reference-state-set-location-state'>set(location, state)</h3>
<p><code>set(location: string, state: object): Promise&lt;void&gt;</code></p>

<p>Sets a state for a particular location. Run will call this whenever a new transaction is published and also when a jig is loaded. The State API should store and return the state in future <code>get</code> calls. This method is asyncronous to allow for third-party network calls.</p>
<h2 id='api-reference-statecache'>StateCache</h2>
<p><code>class StateCache implements State { ... }</code></p>

<p>The default implementation of the <code>State</code> API. The <code>Run</code> class will create one automatically if no state class is provided. The <code>StateCache</code> stores jig state data in an LRU cache in local memory. The default size is 10MB.</p>
<h3 id='api-reference-statecache-constructor-options'>constructor(options)</h3>
<p><code>constructor(options: ?object)</code></p>

<p>Creates the state cache. The options object may be used to configure the cache.</p>
<h4 id='api-reference-statecache-constructor-options-options-object'>Options Object</h4>
<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>maxSizeMB</code></td>
<td>number</td>
<td>Max size in megabytes (MB) of the state data stored in memory</td>
<td>10 (10MB)</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>

  <!-- Twemoji provides the emoji asset in one of the examples -->
  <script src="https://twemoji.maxcdn.com/2/twemoji.min.js?12.0.4" crossorigin="anonymous"></script>

  <script>
    twemoji.parse(document.body)
  </script>

</html>
